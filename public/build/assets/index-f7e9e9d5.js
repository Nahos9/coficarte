import{_ as ue}from"./AppTextarea-7e0e2f52.js";import{V as ce,p as me,a as pe,_ as fe}from"./VPagination-52c4272c.js";import{_ as ve}from"./AppTextField-5188a555.js";import{_ as _e}from"./AppAutocomplete-af35b729.js";import{$ as ke}from"./api-f2619c07.js";import{a as be}from"./axios-439bb627.js";import{u as W}from"./useApi-3f1d0661.js";import{c as H}from"./createUrl-c75b8deb.js";import{r as n,f as J,g as h,c as K,a as t,w as l,u as o,y as m,h as Ve,o as f,b as i,V as v,d as r,i as y,j as b,k as _,t as g,m as X,e as ye}from"./main-463077af.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";import{V as E}from"./VCard-f37805c9.js";import{V as xe}from"./VDialog-4ca17bc7.js";import{V as we}from"./VSnackbar-9493ecb7.js";import{V as x}from"./VCardText-f2d6cd94.js";import{V as Y,a as Ce}from"./VRow-7bef6683.js";import{V as B}from"./VDivider-920c0dd6.js";import{V as $e}from"./VSpacer-97684b93.js";import{V as Te}from"./VAvatar-b69f6ba7.js";import{V as I}from"./VTooltip-d3405e64.js";import"./VTextField-5f329365.js";import"./VImg-85115af3.js";import"./VOverlay-5e671133.js";import"./VSelect-fb294b03.js";import"./VList-36243e5d.js";import"./dialog-transition-11e18e92.js";import"./VMenu-3d9da805.js";import"./VChip-5df8d3ea.js";import"./index-593e39a4.js";import"./useAbility-c6021948.js";const Ue={class:"d-flex flex-wrap gap-4 mx-5"},Ae={class:"d-flex align-center"},De={class:"d-flex gap-4 flex-wrap align-center"},Pe={class:"custom-loader"},he={class:"text-link text-base font-weight-medium d-inline-block"},Be={class:"text-center"},Le={key:0},Re={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Se={class:"text-sm text-medium-emphasis mb-0"},Ee={__name:"index",async setup(Ie){let u,w;const C=n(""),$=n([]),T=n(8),d=n(1),j=n(0),c=n(!1),q=n(""),z=n(""),F=n(""),N=n(),U=n(""),M=n(!1),A=n(null),Z=[{title:"Numéro de carte",key:"credit_card.card_number_fr"},{title:"Prix de vente",key:"sale_price_fr"},{title:"Vendeur",key:"seller.name"},{title:"Date de la vente",key:"sale_date_fr"},{title:"Acheteur",key:"customer_name"},{title:"Type de l'acheteur",key:"customer_type_fr"},{title:"statut",key:"unlock_status_fr"},{title:"Actions",key:"actions",sortable:!1}],{data:L,execute:O}=([u,w]=J(()=>W(H("/sale",{query:{search:C,page:d,with_credit_card:"true",with_seller:"true",with_account_type:"true",seller_id:A}}))),u=await u,w(),u),{data:ee,execute:te}=([u,w]=J(()=>W(H("/user",{query:{paginate:"false",profile:"responsible_for_customer"}}))),u=await u,w(),u),ae=s=>{$.value[s]=!0,setTimeout(()=>{$.value[s]=!1},1e3)},le=s=>{d.value=s.page},oe=async s=>{const e=await ke(`sale/unlock/${s}`,{method:"PUT"});await O(),await te(),U.value="",R.value="",R.value=e.messages.sale,D.value=!0},se=async()=>{ne("/api/sale/download/excel",ye("userToken").value,"sales.xlsx")},ne=(s,e,S)=>{be({url:s,method:"GET",responseType:"blob",headers:{Authorization:`Bearer ${e}`}}).then(k=>{const V=new Blob([k.data],{type:k.headers["content-type"]}),p=document.createElement("a"),P=window.URL.createObjectURL(V);p.href=P,p.setAttribute("download",S),document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(P)}).catch(k=>{console.error("Erreur lors du téléchargement du fichier",k)})},re=h(()=>L.value.data),G=h(()=>L.value.total),Q=h(()=>L.value.last_page),D=n(!1),R=n(""),ie=n("success"),de=h(()=>ee.value.data);return(s,e)=>{const S=_e,k=ve,V=Ve("IconBtn"),p=fe,P=ue;return f(),K("div",null,[t(E,{class:"mb-6"},{default:l(()=>[t(x,null,{default:l(()=>[t(Y,null,{default:l(()=>[t(x,null,{default:l(()=>e[12]||(e[12]=[i("h2",null," Liste des ventes ",-1)])),_:1})]),_:1})]),_:1})]),_:1}),t(E,{title:"Filtres",class:"mb-6"},{default:l(()=>[t(x,null,{default:l(()=>[t(Y,null,{default:l(()=>[t(Ce,{cols:"12",sm:"4"},{default:l(()=>[t(S,{modelValue:o(A),"onUpdate:modelValue":e[0]||(e[0]=a=>m(A)?A.value=a:null),placeholder:"Vendeur","item-title":"name","item-value":"id",items:o(de),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})]),_:1}),t(B,{class:"my-4"})]),_:1}),i("div",Ue,[i("div",Ae,[t(k,{modelValue:o(C),"onUpdate:modelValue":e[1]||(e[1]=a=>m(C)?C.value=a:null),placeholder:"Rechercher une vente",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),t($e),i("div",De,[t(v,{onClick:se,color:"secondary","prepend-icon":"tabler-upload"},{default:l(()=>e[13]||(e[13]=[r(" Exporter ")])),_:1}),s.$can("create","sale")?(f(),y(v,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"sale-add"}},{default:l(()=>e[14]||(e[14]=[r(" Ajouter ")])),_:1})):b("",!0),t(v,{loading:o($)[3],disabled:o($)[3],"prepend-icon":"tabler-refresh",onClick:e[2]||(e[2]=a=>{o(O)(),ae(3)})},{loader:l(()=>[i("span",Pe,[t(_,{icon:"tabler-refresh"})])]),default:l(()=>[e[15]||(e[15]=r(" Recharger "))]),_:1},8,["loading","disabled"])])]),t(B,{class:"mt-4"}),t(o(ce),{"items-per-page":o(T),"onUpdate:itemsPerPage":e[4]||(e[4]=a=>m(T)?T.value=a:null),page:o(d),"onUpdate:page":e[5]||(e[5]=a=>m(d)?d.value=a:null),headers:Z,items:o(re),"items-length":o(G),class:"text-no-wrap","onUpdate:options":le},{"item.unlock_status_fr":l(({item:a})=>[t(Te,{variant:"tonal",color:{locked:"secondary",unlocked:"success"}[a.unlock_status],class:"me-4",size:"40"},{default:l(()=>[t(_,{icon:{locked:"tabler-lock-check",unlocked:"tabler-lock-open"}[a.unlock_status],size:"28"},null,8,["icon"])]),_:2},1032,["color"]),i("div",he,g(a.unlock_status_fr),1)]),"item.actions":l(({item:a})=>[i("div",Be,[i("div",null,[s.$can("read","sale")||s.$can("historical","sale")||s.$can("update","sale")?(f(),y(V,{key:0,to:{name:"sale-id",params:{id:a.id}}},{default:l(()=>[t(I,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:l(()=>e[16]||(e[16]=[r("Details ")])),_:1}),t(_,{icon:" tabler-eye"})]),_:2},1032,["to"])):b("",!0),s.$can("update","sale")?(f(),y(V,{key:1,to:{name:"sale-edit-id",params:{id:a.id}},disabled:a.unlock_status=="locked"},{default:l(()=>[t(I,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:l(()=>e[17]||(e[17]=[r("Modifier ")])),_:1}),t(_,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])):b("",!0)]),s.$can("unblock","sale")?(f(),K("div",Le,[t(B),s.$can("unblock","sale")?(f(),y(V,{key:0,disabled:a.unlock_status=="unlocked",onClick:je=>{j.value=a.id,q.value="Debloquer la vente",z.value="Voulez vous vraiment debloquer cette vente?",N.value=oe,F.value="Debloquer",M.value=!1,c.value=!0}},{default:l(()=>[t(I,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:l(()=>e[18]||(e[18]=[r("Debloquer ")])),_:1}),t(_,{icon:"tabler-lock-open",color:"primary"})]),_:2},1032,["disabled","onClick"])):b("",!0)])):b("",!0)])]),bottom:l(()=>[t(B),i("div",Re,[i("p",Se,g(o(me)({page:o(d),itemsPerPage:o(T)},o(G))),1),t(pe,{modelValue:o(d),"onUpdate:modelValue":e[3]||(e[3]=a=>m(d)?d.value=a:null),length:o(Q),"total-visible":s.$vuetify.display.xs?1:Math.min(o(Q),5)},{prev:l(a=>[t(v,X({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>[t(_,{start:"",icon:"tabler-arrow-left"}),e[19]||(e[19]=r(" Précedent "))]),_:2},1040)]),next:l(a=>[t(v,X({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>[e[20]||(e[20]=r(" Suivant ")),t(_,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),t(xe,{modelValue:o(c),"onUpdate:modelValue":e[10]||(e[10]=a=>m(c)?c.value=a:null),class:"v-dialog-sm"},{default:l(()=>[t(p,{onClick:e[6]||(e[6]=a=>c.value=!o(c))}),t(E,{title:o(q)},{default:l(()=>[t(x,null,{default:l(()=>[r(g(o(z))+" ",1),o(M)?(f(),y(P,{key:0,class:"mt-3",modelValue:o(U),"onUpdate:modelValue":e[7]||(e[7]=a=>m(U)?U.value=a:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):b("",!0)]),_:1}),t(x,{class:"d-flex justify-end gap-3 flex-wrap"},{default:l(()=>[t(v,{color:"secondary",variant:"tonal",onClick:e[8]||(e[8]=a=>c.value=!1)},{default:l(()=>e[21]||(e[21]=[r(" Annuler ")])),_:1}),t(v,{onClick:e[9]||(e[9]=a=>{o(N)(o(j)),c.value=!1})},{default:l(()=>[r(g(o(F)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),t(we,{modelValue:o(D),"onUpdate:modelValue":e[11]||(e[11]=a=>m(D)?D.value=a:null),transition:"scale-transition",location:"top end",color:o(ie)},{default:l(()=>[r(g(o(R)),1)]),_:1},8,["modelValue","color"])])}}},ft=ge(Ee,[["__scopeId","data-v-0c9926de"]]);export{ft as default};
