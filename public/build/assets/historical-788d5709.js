import{_ as ne}from"./AppTextarea-f6cbfc1f.js";import{V as de,p as ue,a as ce,_ as pe}from"./VPagination-35ef7a05.js";import{_ as me}from"./AppTextField-36c47f95.js";import{_ as fe}from"./AppAutocomplete-43a18695.js";import{$ as ve}from"./api-85849cc0.js";import{u as q}from"./useApi-19aec288.js";import{c as O}from"./createUrl-158efc85.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import{V as B}from"./VCard-6fdda96f.js";import{V as Ve}from"./VDialog-6f3109bb.js";import{V as ge}from"./VSnackbar-c35ea671.js";import{V as g}from"./VCardText-4cf73bbc.js";import{V as Q,a as be}from"./VRow-b5d7590c.js";import{V as P}from"./VDivider-b2160256.js";import{V as xe}from"./VSpacer-c7f75bb0.js";import{r,f as G,g as A,c as H,a as t,w as l,u as o,y as p,h as ye,o as m,b as i,V as f,d as n,i as b,j as _,k as v,t as V,l as ke,m as J}from"./main-c1a030b6.js";import{V as we}from"./VAvatar-a68b7878.js";import{V as L}from"./VTooltip-55dc5a01.js";import"./VTextField-6ef51958.js";import"./VImg-96e1ccfc.js";import"./VOverlay-7afe38d6.js";import"./VSelect-05ba9522.js";import"./VList-7bc83e08.js";import"./dialog-transition-f299d117.js";import"./VMenu-e950e983.js";import"./VChip-8fa0cf71.js";import"./index-593e39a4.js";import"./useAbility-c8c15e39.js";const Ce={class:"d-flex flex-wrap gap-4 mx-5"},$e={class:"d-flex align-center"},Pe={class:"d-flex gap-4 flex-wrap align-center"},Ae={class:"custom-loader"},De={class:"text-link text-base font-weight-medium d-inline-block"},Se={class:"d-flex align-center gap-x-4",style:{"min-inline-size":"240px"}},Te={class:"w-75"},Ue={class:"w-25"},Be={class:"text-center"},Le={key:0},Ee={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Ie={class:"text-sm text-medium-emphasis mb-0"},Re={__name:"historical",async setup(he){let u,x;const y=r(""),k=r([]),w=r(8),d=r(1),E=r(0),c=r(!1),I=r(""),R=r(""),h=r(""),z=r(),C=r(""),N=r(!1),D=r(null),K=[{title:"Numéro de carte",key:"card_number_fr"},{title:"Date de livraison",key:"delivery_date_fr"},{title:"Prix de vente",key:"sale.sale_price_fr"},{title:"Vendeur",key:"sale.seller.name"},{title:"Expiration",key:"expiration_per_centage"},{title:"Actions",key:"actions",sortable:!1}],{data:S,execute:j}=([u,x]=G(()=>q(O("/credit-card",{query:{search:y,page:d,with_possessor:"true","with_sale<seller":"true",status:"sold"}}))),u=await u,x(),u),{data:W,execute:X}=([u,x]=G(()=>q(O("/user",{query:{paginate:"false",profile:"responsible_for_customer"}}))),u=await u,x(),u),Y=s=>{k.value[s]=!0,setTimeout(()=>{k.value[s]=!1},1e3)},Z=s=>{d.value=s.page},ee=async s=>{const e=await ve(`credit-card/${s}`,{method:"DELETE"});await j(),await X(),C.value="",T.value="",T.value=e.messages.creditCard,$.value=!0},te=A(()=>S.value.data),F=A(()=>S.value.total),M=A(()=>S.value.last_page),$=r(!1),T=r(""),ae=r("success"),le=A(()=>W.value.data);return(s,e)=>{const oe=fe,re=me,U=ye("IconBtn"),se=pe,ie=ne;return m(),H("div",null,[t(B,{class:"mb-6"},{default:l(()=>[t(g,null,{default:l(()=>[t(Q,null,{default:l(()=>[t(g,null,{default:l(()=>e[12]||(e[12]=[i("h2",null," Liste des coficartes ",-1)])),_:1})]),_:1})]),_:1})]),_:1}),t(B,{title:"Filtres",class:"mb-6"},{default:l(()=>[t(g,null,{default:l(()=>[t(Q,null,{default:l(()=>[t(be,{cols:"12",sm:"4"},{default:l(()=>[t(oe,{modelValue:o(D),"onUpdate:modelValue":e[0]||(e[0]=a=>p(D)?D.value=a:null),placeholder:"Vendeur","item-title":"name","item-value":"id",items:o(le),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})]),_:1}),t(P,{class:"my-4"})]),_:1}),i("div",Ce,[i("div",$e,[t(re,{modelValue:o(y),"onUpdate:modelValue":e[1]||(e[1]=a=>p(y)?y.value=a:null),placeholder:"Rechercher un credit-card",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),t(xe),i("div",Pe,[t(f,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:l(()=>e[13]||(e[13]=[n(" Export ")])),_:1}),s.$can("create","credit-card")?(m(),b(f,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"credit-card-add"}},{default:l(()=>e[14]||(e[14]=[n(" Ajouter ")])),_:1})):_("",!0),t(f,{loading:o(k)[3],disabled:o(k)[3],"prepend-icon":"tabler-refresh",onClick:e[2]||(e[2]=a=>{o(j)(),Y(3)})},{loader:l(()=>[i("span",Ae,[t(v,{icon:"tabler-refresh"})])]),default:l(()=>[e[15]||(e[15]=n(" Recharger "))]),_:1},8,["loading","disabled"])])]),t(P,{class:"mt-4"}),t(o(de),{"items-per-page":o(w),"onUpdate:itemsPerPage":e[4]||(e[4]=a=>p(w)?w.value=a:null),page:o(d),"onUpdate:page":e[5]||(e[5]=a=>p(d)?d.value=a:null),headers:K,items:o(te),"items-length":o(F),class:"text-no-wrap","onUpdate:options":Z},{"item.card_number_fr":l(({item:a})=>[t(we,{variant:"tonal",color:"error",class:"me-4",size:"40"},{default:l(()=>[t(v,{icon:"tabler-credit-card",size:"28"})]),_:1}),i("div",De,V(a.card_number_fr),1)]),"item.expiration_per_centage":l(({item:a})=>[i("div",Se,[i("div",Te,[t(ke,{"model-value":a.expiration_per_centage,rounded:"",color:a.expiration_per_centage<100?"success":"error",height:8},null,8,["model-value","color"])]),i("div",Ue,V(a.expiration_date_fr),1)])]),"item.actions":l(({item:a})=>[i("div",Be,[i("div",null,[s.$can("read","credit-card")||s.$can("historical","credit-card")||s.$can("update","credit-card")?(m(),b(U,{key:0,to:{name:"credit-card-id",params:{id:a.id}}},{default:l(()=>[t(L,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:l(()=>e[16]||(e[16]=[n("Details ")])),_:1}),t(v,{icon:" tabler-eye"})]),_:2},1032,["to"])):_("",!0),s.$can("update","credit-card")?(m(),b(U,{key:1,to:{name:"credit-card-edit-id",params:{id:a.id}},disabled:a.status=="validated"},{default:l(()=>[t(L,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:l(()=>e[17]||(e[17]=[n("Modifier ")])),_:1}),t(v,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])):_("",!0)]),s.$can("delete","credit-card")?(m(),H("div",Le,[t(P),s.$can("delete","credit-card")?(m(),b(U,{key:0,disabled:a.status=="validated",onClick:ze=>{E.value=a.id,I.value="Supprimer la carte",R.value="Voulez vous vraiment supprimer cette coficarte?",z.value=ee,h.value="Supprimer",N.value=!1,c.value=!0}},{default:l(()=>[t(L,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:l(()=>e[18]||(e[18]=[n("Supprimer ")])),_:1}),t(v,{icon:"tabler-trash",color:"error"})]),_:2},1032,["disabled","onClick"])):_("",!0)])):_("",!0)])]),bottom:l(()=>[t(P),i("div",Ee,[i("p",Ie,V(o(ue)({page:o(d),itemsPerPage:o(w)},o(F))),1),t(ce,{modelValue:o(d),"onUpdate:modelValue":e[3]||(e[3]=a=>p(d)?d.value=a:null),length:o(M),"total-visible":s.$vuetify.display.xs?1:Math.min(o(M),5)},{prev:l(a=>[t(f,J({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>[t(v,{start:"",icon:"tabler-arrow-left"}),e[19]||(e[19]=n(" Précedent "))]),_:2},1040)]),next:l(a=>[t(f,J({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>[e[20]||(e[20]=n(" Suivant ")),t(v,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),t(Ve,{modelValue:o(c),"onUpdate:modelValue":e[10]||(e[10]=a=>p(c)?c.value=a:null),class:"v-dialog-sm"},{default:l(()=>[t(se,{onClick:e[6]||(e[6]=a=>c.value=!o(c))}),t(B,{title:o(I)},{default:l(()=>[t(g,null,{default:l(()=>[n(V(o(R))+" ",1),o(N)?(m(),b(ie,{key:0,class:"mt-3",modelValue:o(C),"onUpdate:modelValue":e[7]||(e[7]=a=>p(C)?C.value=a:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):_("",!0)]),_:1}),t(g,{class:"d-flex justify-end gap-3 flex-wrap"},{default:l(()=>[t(f,{color:"secondary",variant:"tonal",onClick:e[8]||(e[8]=a=>c.value=!1)},{default:l(()=>e[21]||(e[21]=[n(" Annuler ")])),_:1}),t(f,{onClick:e[9]||(e[9]=a=>{o(z)(o(E)),c.value=!1})},{default:l(()=>[n(V(o(h)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),t(ge,{modelValue:o($),"onUpdate:modelValue":e[11]||(e[11]=a=>p($)?$.value=a:null),transition:"scale-transition",location:"top end",color:o(ae)},{default:l(()=>[n(V(o(T)),1)]),_:1},8,["modelValue","color"])])}}},mt=_e(Re,[["__scopeId","data-v-1936b757"]]);export{mt as default};
