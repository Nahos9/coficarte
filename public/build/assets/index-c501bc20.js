import{_ as Ve}from"./AppTextarea-f5d859b2.js";import{_ as be}from"./AppSelect-60b2e410.js";import{V as ke,p as ye,a as xe,_ as $e}from"./VPagination-acb55726.js";import{_ as Ce}from"./AppTextField-9a0d8e0e.js";import{_ as we}from"./AppAutocomplete-4289cd9c.js";import{r as l,e as K,f as W,g as B,c as X,a,w as o,h as Pe,o as i,u as d,b as n,V as f,d as s,i as m,j as u,k as c,t as _,l as Ae,m as Y}from"./main-ab682c06.js";import{$ as Ee}from"./api-b60cb23e.js";import{a as Z}from"./axios-439bb627.js";import{u as ee}from"./useApi-359dfef2.js";import{c as te}from"./createUrl-0640aad8.js";import{_ as Se}from"./_plugin-vue_export-helper-c27b6911.js";import{V as ae}from"./VCard-1d94407e.js";import{V as Be}from"./VDialog-6969cf6c.js";import{V as De}from"./VSnackbar-3d97ef73.js";import{V as j}from"./VCardText-6a556de3.js";import{V as Ue,a as he}from"./VRow-a90cbb86.js";import{V as D}from"./VDivider-2d66d0d2.js";import{V as Te}from"./VSpacer-1d4c3417.js";import{V as Ie}from"./VAvatar-7f2408c8.js";import{V as oe}from"./VChip-e7f3e364.js";import{V as k}from"./VTooltip-0ac2a132.js";import"./VTextField-654b64b0.js";import"./VImg-d7e66a8a.js";import"./VOverlay-607de400.js";import"./VSelect-61a0cd14.js";import"./VList-d8c76082.js";import"./dialog-transition-162be527.js";import"./VMenu-7b33faa1.js";import"./index-593e39a4.js";import"./useAbility-6a37d43c.js";const Ne={class:"d-flex flex-wrap gap-4 mx-5"},Re={class:"d-flex align-center"},ze={class:"d-flex gap-4 flex-wrap align-center"},Me={class:"custom-loader"},Le={class:"text-link text-base font-weight-medium d-inline-block"},je={class:"d-flex align-center gap-x-4",style:{"min-inline-size":"240px"}},Fe={class:"w-75"},qe={class:"w-25"},Oe={class:""},Qe={class:"text-center"},Ge={key:0},He={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Je={class:"text-sm text-medium-emphasis mb-0"},Ke={__name:"index",async setup(We){let v,y;const U=l(""),F=K("userData").value,x=l([]),h=l(8),g=l(1),V=l(0),p=l(!1),$=l(""),C=l(""),w=l(""),P=l(),A=l("");l("");const T=l(!1),E=l(!1),I=l(null),N=l(""),R=l(null),re=[{title:"Numéro de carte",key:"card_number_fr"},{title:"Prix de vente",key:"price_fr"},{title:"Reference de la facture",key:"invoice_reference"},{title:"Possesseur",key:"possessor.name"},{title:"Statut",key:"status_fr"},{title:"Expiration",key:"expiration_per_centage"},{title:"Commentaire retour",key:"comment_retour",sortable:!1,show:r=>r.comment_retour!==null&&!r.etat_validation},{title:"Etat",key:"etat"},{title:"Actions",key:"actions",sortable:!1}],{data:z,execute:S}=([v,y]=W(()=>ee(te("/credit-card",{query:{search:U,page:g,possessor_id:I,with_possessor:"true",status:"owned",order_by_desc:"updated_at-id"}}))),v=await v,y(),v),le=r=>{x.value[r]=!0,setTimeout(()=>{x.value[r]=!1},1e3)},se=r=>{g.value=r.page},ne=async r=>{const e=await Ee(`credit-card/${r}`,{method:"DELETE"});await S(),A.value="",L.value="",L.value=e.messages.creditCard,M.value=!0},{data:ie,execute:de}=([v,y]=W(()=>ee(te("/user",{query:{paginate:"false",multi_profile:{marketing_manager:"rc-mm-ah",agency_head:"mm-rc-ah",responsible_for_customer:"rc"}[F.role]}}))),v=await v,y(),v),q=B(()=>ie.value.data),ue=B(()=>z.value.data),O=B(()=>z.value.total),Q=B(()=>z.value.last_page),M=l(!1),L=l(""),ce=l("success"),G=K("userToken").value;function me(){Z.post("https://coficartega.cofinaonline.com/api/credit-card/return-credit-card",{possessor_id:R.value,credit_card_id:V.value,motif:N.value,comment_retour:A.value},{headers:{Authorization:`Bearer ${G}`}}).then(r=>{r&&S()}).catch(r=>console.log(r))}function pe(){Z.post("https://coficartega.cofinaonline.com/api/credit-card/validate-return-credit-card",{credit_card_id:V.value},{headers:{Authorization:`Bearer ${G}`}}).then(r=>{r&&S()}).catch(r=>console.log(r))}return(r,e)=>{const ve=we,fe=Ce,b=Pe("IconBtn"),_e=$e,H=be,ge=Ve;return i(),X("div",null,[a(ae,{title:"Filtres",class:"mb-6"},{default:o(()=>[a(j,null,{default:o(()=>[a(Ue,null,{default:o(()=>[a(he,{cols:"12",sm:"4"},{default:o(()=>[a(ve,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=t=>I.value=t),placeholder:"Possesseur","item-title":"name","item-value":"id",items:d(q),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})]),_:1}),a(D,{class:"my-4"})]),_:1}),n("div",Ne,[n("div",Re,[a(fe,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=t=>U.value=t),placeholder:"Rechercher une carte",density:"compact",style:{"inline-size":"300px"},class:"me-3"},null,8,["modelValue"])]),a(Te),n("div",ze,[a(f,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:o(()=>e[14]||(e[14]=[s(" Export ")])),_:1}),r.$can("create","credit-card")?(i(),m(f,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"credit-card-add"}},{default:o(()=>e[15]||(e[15]=[s(" Ajouter ")])),_:1})):u("",!0),r.$can("update-price","credit-card")?(i(),m(f,{key:1,color:"primary","prepend-icon":"tabler-coin",to:{name:"credit-card-update-price"}},{default:o(()=>e[16]||(e[16]=[s(" Modifier Prix ")])),_:1})):u("",!0),a(f,{loading:x.value[3],disabled:x.value[3],"prepend-icon":"tabler-refresh",onClick:e[2]||(e[2]=t=>{d(S)(),d(de)(),le(3)})},{loader:o(()=>[n("span",Me,[a(c,{icon:"tabler-refresh"})])]),default:o(()=>[e[17]||(e[17]=s(" Recharger "))]),_:1},8,["loading","disabled"])])]),a(D,{class:"mt-4"}),a(d(ke),{"items-per-page":h.value,"onUpdate:itemsPerPage":e[4]||(e[4]=t=>h.value=t),page:g.value,"onUpdate:page":e[5]||(e[5]=t=>g.value=t),headers:re,items:d(ue),"items-length":d(O),class:"text-no-wrap","onUpdate:options":se},{"item.card_number_fr":o(({item:t})=>[a(Ie,{variant:"tonal",color:"error",class:"me-4",size:"40"},{default:o(()=>[a(c,{icon:"tabler-credit-card",size:"28"})]),_:1}),n("div",Le,_(t.card_number_fr),1)]),"item.status_fr":o(({item:t})=>[a(oe,{class:"ma-2",color:{"En vente":"success","Au siège":"secondary","En agence":"primary"}[t.status_fr],label:""},{default:o(()=>[a(c,{icon:{"En vente":"tabler-shopping-bag","Au siège":"tabler-tower","En agence":"tabler-building"}[t.status_fr],start:""},null,8,["icon"]),s(" "+_(t.status_fr),1)]),_:2},1032,["color"])]),"item.expiration_per_centage":o(({item:t})=>[n("div",je,[n("div",Fe,[a(Ae,{"model-value":t.expiration_per_centage,rounded:"",color:t.expiration_per_centage<100?"success":"error",height:8},null,8,["model-value","color"])]),n("div",qe,_(t.expiration_date_fr),1)])]),"item.etat":o(({item:t})=>[n("div",Oe,[a(oe,{class:"ma-2",color:{Endommage:"error","Non vendu":"warning",Bon:"success"}[t.etat],label:""},{default:o(()=>[a(c,{icon:{Endommage:"tabler-alert-triangle","Non vendu":"tabler-alert-circle",Bon:"tabler-check"}[t.etat],start:""},null,8,["icon"]),s(" "+_(t.etat),1)]),_:2},1032,["color"]),e[18]||(e[18]=n("div",{class:"w-25"},null,-1))])]),"item.actions":o(({item:t})=>[n("div",Qe,[n("div",null,[r.$can("read","credit-card")||r.$can("historical","credit-card")||r.$can("update","credit-card")?(i(),m(b,{key:0,to:{name:"credit-card-id",params:{id:t.id}}},{default:o(()=>[a(k,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:o(()=>e[19]||(e[19]=[s("Details ")])),_:1}),a(c,{icon:" tabler-eye"})]),_:2},1032,["to"])):u("",!0),r.$can("read","credit-card")||r.$can("historical","credit-card")||r.$can("update","credit-card")?(i(),m(b,{key:1,cardId:t.id,onClick:J=>{V.value=t.id,$.value="Retourner la carte",C.value="Motif du retour de la carte",P.value=me,w.value="Retourner",E.value=!0,p.value=!0}},{default:o(()=>[a(k,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:o(()=>e[20]||(e[20]=[s("Retourner ")])),_:1}),a(c,{icon:" tabler-transfer-in"})]),_:2},1032,["cardId","onClick"])):u("",!0),r.$can("update","credit-card")?(i(),m(b,{key:2,to:{name:"credit-card-edit-id",params:{id:t.id}},disabled:t.status=="validated"},{default:o(()=>[a(k,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:o(()=>e[21]||(e[21]=[s("Modifier ")])),_:1}),a(c,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])):u("",!0)]),a(D),r.$can("delete","credit-card")?(i(),X("div",Ge,[r.$can("delete","credit-card")?(i(),m(b,{key:0,disabled:t.status=="validated",onClick:J=>{V.value=t.id,$.value="Supprimer la carte",C.value="Voulez vous vraiment supprimer cette coficarte?",P.value=ne,w.value="Supprimer",T.value=!1,p.value=!0}},{default:o(()=>[a(k,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:o(()=>e[22]||(e[22]=[s("Supprimer ")])),_:1}),a(c,{icon:"tabler-trash",color:"error"})]),_:2},1032,["disabled","onClick"])):u("",!0),r.$can("validate","credit-card")&&d(F).role==="marketing_manager"&&["Endommage","Non vendu"].includes(t.etat)&&!t.etat_validation?(i(),m(b,{key:1,onClick:J=>{V.value=t.id,$.value="Valider le retour",C.value="Voulez vous vraiment valider ce retour de carte?",P.value=pe,w.value="Valider",T.value=!1,p.value=!0}},{default:o(()=>[a(k,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:o(()=>e[23]||(e[23]=[s("Valider le retour ")])),_:1}),a(c,{icon:"tabler-check",color:"success"})]),_:2},1032,["onClick"])):u("",!0)])):u("",!0)])]),bottom:o(()=>[a(D),n("div",He,[n("p",Je,_(d(ye)({page:g.value,itemsPerPage:h.value},d(O))),1),a(xe,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),length:d(Q),"total-visible":r.$vuetify.display.xs?1:Math.min(d(Q),5)},{prev:o(t=>[a(f,Y({variant:"tonal",color:"default"},t,{icon:!1}),{default:o(()=>[a(c,{start:"",icon:"tabler-arrow-left"}),e[24]||(e[24]=s(" Précedent "))]),_:2},1040)]),next:o(t=>[a(f,Y({variant:"tonal",color:"default"},t,{icon:!1}),{default:o(()=>[e[25]||(e[25]=s(" Suivant ")),a(c,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),a(Be,{modelValue:p.value,"onUpdate:modelValue":e[12]||(e[12]=t=>p.value=t),class:"v-dialog-sm"},{default:o(()=>[a(_e,{onClick:e[6]||(e[6]=t=>p.value=!p.value)}),a(ae,{title:$.value},{default:o(()=>[a(j,null,{default:o(()=>[s(_(C.value)+" ",1),E.value?(i(),m(H,{key:0,class:"mt-3",items:["Endommage","Non vendu"],modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=t=>N.value=t),label:"Motif"},null,8,["modelValue"])):u("",!0),E.value?(i(),m(H,{key:1,class:"mt-3",items:d(q),"item-title":"name","item-value":"id",label:"Nouveau possesseur",modelValue:R.value,"onUpdate:modelValue":e[8]||(e[8]=t=>R.value=t),placeholder:"Sélectionner un possesseur"},null,8,["items","modelValue"])):u("",!0),T.value||E.value?(i(),m(ge,{key:2,class:"mt-3",modelValue:A.value,"onUpdate:modelValue":e[9]||(e[9]=t=>A.value=t),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):u("",!0)]),_:1}),a(j,{class:"d-flex justify-end gap-3 flex-wrap"},{default:o(()=>[a(f,{color:"secondary",variant:"tonal",onClick:e[10]||(e[10]=t=>p.value=!1)},{default:o(()=>e[26]||(e[26]=[s(" Annuler ")])),_:1}),a(f,{onClick:e[11]||(e[11]=t=>{P.value(V.value),p.value=!1})},{default:o(()=>[s(_(w.value),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),a(De,{modelValue:M.value,"onUpdate:modelValue":e[13]||(e[13]=t=>M.value=t),transition:"scale-transition",location:"top end",color:ce.value},{default:o(()=>[s(_(L.value),1)]),_:1},8,["modelValue","color"])])}}},At=Se(Ke,[["__scopeId","data-v-5c553047"]]);export{At as default};
