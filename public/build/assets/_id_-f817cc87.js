import{r as p}from"./validators-be8c4c00.js";import{r as _,f as k,e as P,g as A,c as O,a as e,w as t,u as r,i as I,F as z,p as G,q as H,v as K,o as Q,s as W,V as y,d as f,x as X,b as g,l as N,t as Y,y as Z}from"./main-276112f6.js";import{_ as ee}from"./AppDateTimePicker-5ea3ef30.js";import{_ as re}from"./AppSelect-64bc018d.js";import{_ as ae}from"./AppTextField-b981902d.js";import{_ as te}from"./AppAutocomplete-44d0561a.js";import{u as x}from"./useApi-18850fce.js";import{c as C}from"./createUrl-b8957e91.js";import{$ as le}from"./api-024e2dfc.js";import{V,a as u}from"./VRow-507d2620.js";import{V as oe}from"./VSnackbar-ae807d5e.js";import{V as se}from"./VForm-e05b516f.js";import{V as ue}from"./VCard-5ab8a938.js";import{V as de}from"./VCardText-bf95dae8.js";import"./VTextField-afd8f7dc.js";import"./VImg-ea895d59.js";import"./VOverlay-4f3d716d.js";import"./VSelect-68002142.js";import"./VList-a42ca4ab.js";import"./VAvatar-3c74ef22.js";import"./VDivider-01cbde56.js";import"./dialog-transition-e4e964c2.js";import"./VMenu-70193b87.js";import"./VChip-f5afc124.js";import"./index-593e39a4.js";import"./useAbility-42453ee0.js";const ie={class:"d-flex align-center justify-center pa-2"},ne={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},me={class:"d-flex gap-4 align-center flex-wrap"},Le={__name:"[id]",async setup(ce){let d,m;const $=G(),w=H();let E="/sale";const U=()=>({sale_date:"",credit_card_id:"",number_id:"",customer_type:"",customer_name:"",account_number:"",account_type_id:"",customer_phone_number:""}),i=_(U()),{data:F}=([d,m]=k(()=>x(C(`/sale/${w.params.id}`,{query:{with_credit_card:"true",with_seller:"true",with_account_type:"true"}}))),d=await d,m(),d);var l=_(F.value.data.sale);const D=_(),R=()=>{var s;(s=D.value)==null||s.validate().then(async({valid:a})=>{if(a){const c=await le(`/sale/${w.params.id}`,{method:"PUT",body:{sale_date:l.value.sale_date,credit_card_id:l.value.credit_card_id,number_id:l.value.number_id,customer_type:l.value.customer_type,customer_name:l.value.customer_name,account_number:l.value.account_number,account_type_id:l.value.account_type_id,customer_phone_number:l.value.customer_phone_number}});if(i.value=U(),c.status==200)$.push(E);else{b.value=!0,S.value="error",q.value="";for(const n in c.errors)c.errors[n].forEach(v=>{q.value+=v+`
`,i.value[n]+=v+`
`})}Z(()=>{})}})},h=P("userData").value,{data:j}=([d,m]=k(()=>x(C("/credit-card",{query:{possessor_id:h.id,status:"owned",paginate:"false"}}))),d=await d,m(),d),T=A(()=>j.value.data);T.value.push(JSON.parse(JSON.stringify(l.value.credit_card)));const{data:B}=([d,m]=k(()=>x(C("/account-type",{query:{paginate:"false"}}))),d=await d,m(),d),L=A(()=>B.value.data),b=_(!1),q=_(""),S=_("success");return(s,a)=>{const c=te,n=ae,v=re,J=ee,M=K("mask");return Q(),O(z,null,[e(V,null,{default:t(()=>[e(u,{cols:"12",md:"12"},{default:t(()=>[e(se,{ref_key:"refForm",ref:D,onSubmit:W(R,["prevent"])},{default:t(()=>[e(V,null,{default:t(()=>[e(u,{cols:"11"},{default:t(()=>[e(y,{"prepend-icon":"tabler-arrow-narrow-left",to:r(E)},{default:t(()=>a[9]||(a[9]=[f(" ventes ")])),_:1},8,["to"])]),_:1}),e(u,{cols:"1",class:"text-right"},{default:t(()=>[e(y,{"append-icon":"tabler-eye",to:{name:"sale-id",params:{id:r(w).params.id}}},{default:t(()=>a[10]||(a[10]=[f(" Voir ")])),_:1},8,["to"])]),_:1})]),_:1}),e(V,null,{default:t(()=>[e(u,{md:"12"},{default:t(()=>[e(ue,{class:"mb-6",title:"Modification du sale de comité"},{default:t(()=>[e(de,null,{default:t(()=>[e(V,null,{default:t(()=>[e(u,{cols:"12",md:"12",lg:"9"},{default:t(()=>[e(V,null,{default:t(()=>[e(u,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(c,{modelValue:r(l).credit_card_id,"onUpdate:modelValue":a[0]||(a[0]=o=>r(l).credit_card_id=o),items:r(T),"error-messages":r(i).credit_card_id,label:"Carte vendu","item-title":"card_number_fr","item-value":"id",rules:["requiredValidator"in s?s.requiredValidator:r(p)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),e(u,{cols:"12",md:"12",lg:"12"},{default:t(()=>[X(e(n,{modelValue:r(l).number_id,"onUpdate:modelValue":a[1]||(a[1]=o=>r(l).number_id=o),"error-messages":r(i).number_id,label:"4 Derniers chiffres du numéro de la carte",placeholder:"Ex: 2595",rules:["requiredValidator"in s?s.requiredValidator:r(p)]},null,8,["modelValue","error-messages","rules"]),[[M,"####"]])]),_:1}),e(u,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(v,{modelValue:r(l).customer_type,"onUpdate:modelValue":a[2]||(a[2]=o=>r(l).customer_type=o),items:[{title:"Entreprise",value:"business"},{title:"Particulier",value:"particular"}],"error-messages":r(i).customer_type,label:"Type de l'acheteur",rules:["requiredValidator"in s?s.requiredValidator:r(p)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(u,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(n,{modelValue:r(l).customer_name,"onUpdate:modelValue":a[3]||(a[3]=o=>r(l).customer_name=o),"error-messages":r(i).customer_name,label:"Nom du client",placeholder:"Ex: John",rules:["requiredValidator"in s?s.requiredValidator:r(p)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(u,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(n,{modelValue:r(l).account_number,"onUpdate:modelValue":a[4]||(a[4]=o=>r(l).account_number=o),type:"number","error-messages":r(i).account_number,label:"Numéro de compte du client",placeholder:"Ex: 251789654001"},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(n,{modelValue:r(l).customer_phone_number,"onUpdate:modelValue":a[5]||(a[5]=o=>r(l).customer_phone_number=o),"error-messages":r(i).customer_phone_number,label:"Numéro de téléphone du client",placeholder:"Ex: +228 90 90 90 90"},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(c,{modelValue:r(l).account_type_id,"onUpdate:modelValue":a[6]||(a[6]=o=>r(l).account_type_id=o),items:r(L),"error-messages":r(i).account_type_id,label:"Type de compte","item-title":"name","item-value":"id",rules:["requiredValidator"in s?s.requiredValidator:r(p)]},null,8,["modelValue","items","error-messages","rules"])]),_:1})]),_:1})]),_:1}),e(u,{cols:"12",md:"12",lg:"3"},{default:t(()=>[g("div",ie,[e(J,{modelValue:r(l).sale_date,"onUpdate:modelValue":a[7]||(a[7]=o=>r(l).sale_date=o),"error-messages":r(i).sale_date,label:"Date de la vente",rules:["requiredValidator"in s?s.requiredValidator:r(p)],config:{inline:!0},class:"calendar-date-picker"},null,8,["modelValue","error-messages","rules"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12"},{default:t(()=>[g("div",ne,[a[13]||(a[13]=g("div",{class:"d-flex flex-column justify-center"},null,-1)),g("div",me,[e(y,{type:"reset",variant:"tonal",color:"primary"},{default:t(()=>[e(N,{start:"",icon:"tabler-circle-minus"}),a[11]||(a[11]=f(" Effacer "))]),_:1}),e(y,{type:"submit",class:"me-3"},{default:t(()=>[a[12]||(a[12]=f(" Enregistrer ")),e(N,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),e(oe,{modelValue:r(b),"onUpdate:modelValue":a[8]||(a[8]=o=>I(b)?b.value=o:null),transition:"scale-transition",location:"top end",color:r(S)},{default:t(()=>[f(Y(r(q)),1)]),_:1},8,["modelValue","color"])],64)}}};export{Le as default};
