import{r as _}from"./validators-be8c4c00.js";import{E as z,G as Q,H as W,I as X,J as Y,g as $,K as Z,L as ee,a,m as B,r as v,e as ae,f as R,A as le,c as te,b as f,w as r,q as re,n as oe,s as se,o as ue,u as i,v as de,V as N,d as E,k as L,t as ie,x as ne}from"./main-af2b2d5d.js";import{_ as me}from"./AppDateTimePicker-6d10a636.js";import{_ as ce}from"./AppAutocomplete-6cef8870.js";import{_ as pe}from"./AppTextField-1531a74f.js";import{_ as M}from"./AppSelect-ae8fb2f7.js";import{$ as _e}from"./api-7fc7f35c.js";import{u as G}from"./useApi-bcd24cb9.js";import{c as J}from"./createUrl-16dc1e84.js";import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";import{V as A,a as s}from"./VRow-601e1b9d.js";import{V as fe}from"./VForm-1356deb0.js";import{V as Ve}from"./VSnackbar-629613a5.js";import{V as be}from"./VCard-bf989272.js";import{V as ye}from"./VCardText-ca8377a1.js";import{m as ge,a as H}from"./VSelect-df695672.js";import{m as xe,u as ke,V as K}from"./VTextField-29c49680.js";import"./VOverlay-cb1675d4.js";import"./VImg-c0d910b9.js";import"./VList-eefec05a.js";import"./VAvatar-962a7ec6.js";import"./VDivider-e22d08d7.js";import"./VMenu-87bd5e8d.js";import"./dialog-transition-2395bc87.js";import"./VChip-ab38d90e.js";import"./index-593e39a4.js";import"./useAbility-e19d3205.js";const Ce=z({...xe(),...Q(ge(),["inline"])},"VCheckbox"),we=W()({name:"VCheckbox",inheritAttrs:!1,props:Ce(),emits:{"update:modelValue":n=>!0,"update:focused":n=>!0},setup(n,m){let{attrs:b,slots:q}=m;const e=X(n,"modelValue"),{isFocused:V,focus:U,blur:p}=ke(n),h=Y(),P=$(()=>n.id||`checkbox-${h}`);return Z(()=>{const[u,x]=ee(b),[D,F]=K.filterProps(n),[T,S]=H.filterProps(n);return a(K,B({class:["v-checkbox",n.class]},u,D,{modelValue:e.value,"onUpdate:modelValue":k=>e.value=k,id:P.value,focused:V.value,style:n.style}),{...q,default:k=>{let{id:j,messagesId:y,isDisabled:C,isReadonly:w}=k;return a(H,B(T,{id:j.value,"aria-describedby":y.value,disabled:C.value,readonly:w.value},x,{modelValue:e.value,"onUpdate:modelValue":I=>e.value=I,onFocus:U,onBlur:p}),q)}})}),{}}});const qe={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},Ue={class:"d-flex gap-4",style:{width:"100%"}},he={class:"d-flex align-center justify-center pa-2"},Ee={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},Ae={class:"d-flex flex-column justify-center"},Pe={class:"d-flex gap-4 align-center flex-wrap"},De={__name:"add",async setup(n){let m,b;const q=oe(),e=v({sale_date:null,credit_card_id:null,number_id:"8456",customer_type:null,customer_name:null,type_piece:null,number_piece:null,date_expiration:null,account_number:null,account_type_id:null,customer_phone_number:null,is_dotation:!1}),V=v(""),U=v(""),p=v(null),h=()=>({sale_date:"",credit_card_id:"",number_id:"",customer_type:"",customer_name:"",type_piece:"",number_piece:"",date_expiration:"",account_type_id:"",customer_phone_number:"",is_dotation:""}),P=[{value:"cni",title:"Carte d'identité nationale"},{value:"passport",title:"Passeport"},{value:"residence_certificate",title:"Certificat de résidence"},{value:"driving_licence",title:"Permis de conduire"},{value:"carte_sej",title:"Carte de séjour"}],u=v(h()),x=v(),D=()=>{var o;(o=x.value)==null||o.validate().then(async({valid:l})=>{if(l){const d=await _e("/sale",{method:"POST",body:{sale_date:e.value.sale_date,credit_card_id:e.value.credit_card_id,number_id:e.value.number_id,customer_type:e.value.customer_type,customer_name:e.value.customer_name,type_piece:e.value.type_piece,number_piece:e.value.number_piece,date_expiration:e.value.date_expiration,account_number:e.value.account_number,account_type_id:e.value.account_type_id,customer_phone_number:e.value.customer_phone_number,is_dotation:e.value.is_dotation}});if(u.value=h(),d.status==201)w.value="success",y.value=!0,q.push("/sale");else{w.value="error",y.value=!0,C.value="";for(const c in d.errors)d.errors[c].forEach(g=>{console.log(c+": "+g),u.value[c]+=g+`
`,C.value+=c+": "+g+", "})}ne(()=>{var c;(c=x.value)==null||c.resetValidation()})}})},F=ae("userData").value,{data:T}=([m,b]=R(()=>G(J("/credit-card",{query:{possessor_id:F.id,status:"owned",paginate:"false"}}))),m=await m,b(),m),S=$(()=>T.value.data),{data:k}=([m,b]=R(()=>G(J("/account-type",{query:{paginate:"false"}}))),m=await m,b(),m),j=$(()=>k.value.data),y=v(!1),C=v(""),w=v("success"),I=async()=>{if(V.value){const o=await fetch(`/api/ecritures/search?search=${encodeURIComponent(V.value)}`);if(!o.ok)throw new Error("Erreur lors de la récupération des données");return await o.json()}};return le(V,async o=>{o&&(p.value=await I(),e.value.account_number=p.value.data.ecritures[0].no_compte,e.value.customer_name=p.value.data.ecritures[0].nom_replegal,e.value.customer_phone_number=p.value.data.ecritures[0].tel_replegal,e.value.customer_phone_number=p.value.data.ecritures[0].tel_replegal,e.value.date_expiration=p.value.data.ecritures[0].dval_piece,e.value.number_piece=p.value.data.ecritures[0].numero_piece_identite)}),(o,l)=>{const d=pe,c=ce,g=me,O=se("mask");return ue(),te("div",null,[f("div",qe,[f("div",Ue,[l[15]||(l[15]=f("div",{class:"d-flex flex-column justify-center"},[f("h4",{class:"text-h4 font-weight-medium"},"Ajouter des cartes"),f("span",null,"Informations sur la première cartes du lot")],-1)),a(A,null,{default:r(()=>[a(s,{cols:"12",md:"6",lg:"4"},{default:r(()=>[a(d,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=t=>V.value=t),label:"Numéro de compte"},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"6",lg:"4"},{default:r(()=>[a(d,{modelValue:U.value,"onUpdate:modelValue":l[1]||(l[1]=t=>U.value=t),label:"Numéro de l'evenement"},null,8,["modelValue"])]),_:1})]),_:1})])]),a(fe,{ref_key:"refForm",ref:x,onSubmit:re(D,["prevent"])},{default:r(()=>[a(A,null,{default:r(()=>[a(s,{md:"12"},{default:r(()=>[a(be,{class:"mb-6",title:"Information des cartes"},{default:r(()=>[a(ye,null,{default:r(()=>[a(A,null,{default:r(()=>[a(s,{cols:"12",md:"12",lg:"9"},{default:r(()=>[a(A,null,{default:r(()=>[a(s,{cols:"12",md:"12",lg:"12"},{default:r(()=>[a(c,{modelValue:e.value.credit_card_id,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value.credit_card_id=t),items:i(S),"error-messages":u.value.credit_card_id,label:"Carte vendu","item-title":"card_number_fr","item-value":"id",rules:["requiredValidator"in o?o.requiredValidator:i(_)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:r(()=>[de(a(d,{modelValue:e.value.number_id,"onUpdate:modelValue":l[3]||(l[3]=t=>e.value.number_id=t),"error-messages":u.value.number_id,label:"4 Derniers chiffres du numéro de la carte",placeholder:"Ex: 2595",rules:["requiredValidator"in o?o.requiredValidator:i(_)]},null,8,["modelValue","error-messages","rules"]),[[O,"####"]])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:r(()=>[a(M,{modelValue:e.value.customer_type,"onUpdate:modelValue":l[4]||(l[4]=t=>e.value.customer_type=t),items:[{title:"Entreprise",value:"business"},{title:"Particulier",value:"particular"}],"error-messages":u.value.customer_type,label:"Type de l'acheteur",rules:["requiredValidator"in o?o.requiredValidator:i(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:r(()=>[a(d,{modelValue:e.value.customer_name,"onUpdate:modelValue":l[5]||(l[5]=t=>e.value.customer_name=t),"error-messages":u.value.customer_name,label:"Nom du client",placeholder:"Ex: John",rules:["requiredValidator"in o?o.requiredValidator:i(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12"},{default:r(()=>[a(M,{modelValue:e.value.type_piece,"onUpdate:modelValue":l[6]||(l[6]=t=>e.value.type_piece=t),items:P,"error-messages":u.value.type_piece,label:"Type de la pièce d'identité",rules:["requiredValidator"in o?o.requiredValidator:i(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12"},{default:r(()=>[a(d,{modelValue:e.value.number_piece,"onUpdate:modelValue":l[7]||(l[7]=t=>e.value.number_piece=t),"error-messages":u.value.number_piece,label:"Numéro de la pièce",placeholder:"Ex: GA2456TA",rules:["requiredValidator"in o?o.requiredValidator:i(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12"},{default:r(()=>[a(g,{modelValue:e.value.date_expiration,"onUpdate:modelValue":l[8]||(l[8]=t=>e.value.date_expiration=t),"error-messages":u.value.date_expiration,label:"Date de validité de la pièce d'identité",rules:["requiredValidator"in o?o.requiredValidator:i(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:r(()=>[a(d,{modelValue:e.value.account_number,"onUpdate:modelValue":l[9]||(l[9]=t=>e.value.account_number=t),type:"number","error-messages":u.value.account_number,label:"Numéro de compte du client",placeholder:"Ex: 371360000786"},null,8,["modelValue","error-messages"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:r(()=>[a(d,{modelValue:e.value.customer_phone_number,"onUpdate:modelValue":l[10]||(l[10]=t=>e.value.customer_phone_number=t),"error-messages":u.value.customer_phone_number,rules:["requiredValidator"in o?o.requiredValidator:i(_)],label:"Numéro de téléphone du client",placeholder:"Ex: +241 77 56 76 00"},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:r(()=>[a(we,{modelValue:e.value.is_dotation,"onUpdate:modelValue":l[11]||(l[11]=t=>e.value.is_dotation=t),"error-messages":u.value.is_dotation,label:"Dotation"},null,8,["modelValue","error-messages"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:r(()=>[a(c,{modelValue:e.value.account_type_id,"onUpdate:modelValue":l[12]||(l[12]=t=>e.value.account_type_id=t),items:i(j),"error-messages":u.value.account_type_id,label:"Type de compte","item-title":"name","item-value":"id"},null,8,["modelValue","items","error-messages"])]),_:1})]),_:1})]),_:1}),a(s,{cols:"12",md:"12",lg:"3"},{default:r(()=>[f("div",he,[a(g,{modelValue:e.value.sale_date,"onUpdate:modelValue":l[13]||(l[13]=t=>e.value.sale_date=t),"error-messages":u.value.sale_date,label:"Date de la vente",rules:["requiredValidator"in o?o.requiredValidator:i(_)],config:{inline:!0},class:"calendar-date-picker"},null,8,["modelValue","error-messages","rules"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(s,{cols:"12"},{default:r(()=>[f("div",Ee,[f("div",Ae,[a(s,{cols:"11"},{default:r(()=>[a(N,{"prepend-icon":"tabler-arrow-narrow-left",to:"/sale"},{default:r(()=>l[16]||(l[16]=[E(" ventes ")])),_:1})]),_:1})]),f("div",Pe,[a(N,{type:"reset",variant:"tonal",color:"primary"},{default:r(()=>[a(L,{start:"",icon:"tabler-circle-minus"}),l[17]||(l[17]=E(" Effacer "))]),_:1}),a(N,{type:"submit",class:"me-3"},{default:r(()=>[l[18]||(l[18]=E(" Enregistrer ")),a(L,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512),a(Ve,{modelValue:y.value,"onUpdate:modelValue":l[14]||(l[14]=t=>y.value=t),transition:"scale-transition",location:"top end",color:w.value},{default:r(()=>[E(ie(C.value),1)]),_:1},8,["modelValue","color"])])}}},oa=ve(De,[["__scopeId","data-v-0592cb3f"]]);export{oa as default};
