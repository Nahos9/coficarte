import{r as y,e as L}from"./validators-be8c4c00.js";import{r as u,c as F,a as r,w as t,u as s,i as M,F as D,q as N,p as A,o as E,b as d,A as _,d as f,t as k,s as $,V as j,e as V,y as U}from"./main-6c5357b5.js";import{_ as z}from"./AppTextField-d3945dd9.js";import{u as h,m as P,a as G}from"./misc-mask-light-4dc83fe5.js";import{V as O}from"./VNodeRenderer-6b8738b1.js";import{u as H}from"./useAbility-0154d632.js";import{$ as J}from"./api-606af7a9.js";import{V as w,a as c}from"./VRow-8103f026.js";import{V as K}from"./VSnackbar-06b63ae1.js";import{V as x}from"./VImg-9d008c95.js";import{V as Q}from"./VCard-dc87bf31.js";import{V as T}from"./VCardText-e8274b7b.js";import{V as W}from"./VForm-88f4e97a.js";import"./VInput-1661bdca.js";import"./easing-9f15041e.js";import"./VTextField-2fd207a8.js";import"./VOverlay-cd754bf3.js";import"./index-593e39a4.js";import"./VAvatar-de22e4a2.js";const X="/build/assets/auth-v2-login-illustration-dark-97bf830f.png",Y="/build/assets/auth-v2-login-illustration-dark-97bf830f.png",Z="/build/assets/auth-v2-login-illustration-dark-97bf830f.png",ee="/build/assets/auth-v2-login-illustration-dark-97bf830f.png";const ae={class:"position-relative bg-background rounded-lg w-100 ma-8 me-0"},se={class:"d-flex align-center justify-center w-100 h-100"},re={class:"text-h4 mb-1"},oe={class:"text-capitalize"},Te={__name:"login",setup(te){const q=h(ee,Z,Y,X,!0),C=h(G,P),m=u(!1),b=N(),I=A(),R=H(),l=u({email:void 0,password:void 0}),v=u(),i=u({email:"",password:""}),S=async()=>{try{const a=await J("/auth/login",{method:"POST",body:{email:i.value.email,password:i.value.password},onResponseError({response:e}){l.value=e._data.errors}});if(l.value.email=void 0,l.value.password=void 0,a.status==200){const{userToken:e,user:o}=a.data;V("userAbilityRules").value=o.ability_rules,R.update(o.ability_rules),V("userData").value={id:o.id,fullName:o.full_name,username:o.name,avatar:"/images/avatars/avatar-1.png",email:o.email,role:o.profile,role_fr:o.profile_fr,agency_name:o.agency.name},V("userToken").value=e,await U(()=>{I.replace(b.query.to?String(b.query.to):"/")})}else if(a.status!=200)if(console.log(a.status),a.errors.email)l.value.email=a.errors.email[0];else if(a.errors.password)l.value.password=a.errors.password[0];else{p.value=!0,g.value="";for(const e in a.errors)e!="sub_code"&&a.errors[e].forEach(o=>{g.value+=o+`
`})}}catch(a){console.error(a)}},B=()=>{var a;(a=v.value)==null||a.validate().then(({valid:e})=>{e&&S()})},p=u(!1),g=u("");return(a,e)=>{const o=z;return E(),F(D,null,[r(w,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:t(()=>[r(c,{lg:"8",class:"d-none d-lg-flex"},{default:t(()=>[d("div",ae,[d("div",se,[r(x,{"max-width":"505",src:s(q),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),r(x,{src:s(C),class:"auth-footer-mask"},null,8,["src"])])]),_:1}),r(c,{cols:"12",lg:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:t(()=>[r(Q,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:t(()=>[r(T,null,{default:t(()=>[r(s(O),{nodes:s(_).app.logo,class:"mb-6"},null,8,["nodes"]),d("h4",re,[e[4]||(e[4]=f(" Bienvenue sur ")),d("span",oe,k(s(_).app.title),1),e[5]||(e[5]=f("! 👋🏻 "))]),e[6]||(e[6]=d("p",{class:"mb-0"}," Veuillez vous connecter ",-1))]),_:1}),r(T,null,{default:t(()=>[r(s(W),{ref_key:"refVForm",ref:v,onSubmit:$(B,["prevent"])},{default:t(()=>[r(w,null,{default:t(()=>[r(c,{cols:"12"},{default:t(()=>[r(o,{modelValue:s(i).email,"onUpdate:modelValue":e[0]||(e[0]=n=>s(i).email=n),label:"Email",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in a?a.requiredValidator:s(y),"emailValidator"in a?a.emailValidator:s(L)],"error-messages":s(l).email},null,8,["modelValue","rules","error-messages"])]),_:1}),r(c,{cols:"12"},{default:t(()=>[r(o,{modelValue:s(i).password,"onUpdate:modelValue":e[1]||(e[1]=n=>s(i).password=n),label:"Mot de passe",placeholder:"············",rules:["requiredValidator"in a?a.requiredValidator:s(y)],type:s(m)?"text":"password","error-messages":s(l).password,"append-inner-icon":s(m)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=n=>m.value=!s(m)),class:"mb-8"},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),r(j,{block:"",type:"submit"},{default:t(()=>e[7]||(e[7]=[f(" Connexion ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),r(K,{modelValue:s(p),"onUpdate:modelValue":e[3]||(e[3]=n=>M(p)?p.value=n:null),transition:"scroll-y-reverse-transition",location:"bottom end",color:"error"},{default:t(()=>[f(k(s(g)),1)]),_:1},8,["modelValue"])],64)}}};export{Te as default};
