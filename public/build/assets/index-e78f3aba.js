import{_ as ne}from"./AppTextarea-18bc53e3.js";import{V as de,p as ce,a as ue,_ as pe}from"./VPagination-eb5ddfdd.js";import{_ as me}from"./AppTextField-aecddfd7.js";import{_ as fe}from"./AppAutocomplete-68985466.js";import{$ as ve}from"./api-3c679596.js";import{r as l,e as _e,f as q,g as P,c as O,a,w as o,u as s,i as p,h as ge,o as m,b as n,V as f,d as i,j as V,k as _,l as v,t as g,m as Ve,n as Q}from"./main-abcc8a13.js";import{u as G}from"./useApi-ddbed001.js";import{c as H}from"./createUrl-fb7e5501.js";import{_ as be}from"./_plugin-vue_export-helper-c27b6911.js";import{V as J}from"./VCard-11b5ea39.js";import{V as xe}from"./VDialog-602dd537.js";import{V as ye}from"./VSnackbar-15a93453.js";import{V as T}from"./VCardText-45ff63bc.js";import{V as ke,a as Ce}from"./VRow-495481b0.js";import{V as A}from"./VDivider-682ef444.js";import{V as we}from"./VSpacer-14c287f8.js";import{V as $e}from"./VAvatar-a4c10e9a.js";import{V as Pe}from"./VChip-f4db87d0.js";import{V as U}from"./VTooltip-c34897a3.js";import"./VTextField-d1707aa4.js";import"./VImg-ddc717a8.js";import"./VOverlay-af4676a3.js";import"./VSelect-0aaf0c44.js";import"./VList-1536a853.js";import"./dialog-transition-bb32810d.js";import"./VMenu-6c978d13.js";import"./index-593e39a4.js";import"./useAbility-01e69c29.js";const Ae={class:"d-flex flex-wrap gap-4 mx-5"},De={class:"d-flex align-center"},Se={class:"d-flex gap-4 flex-wrap align-center"},Ee={class:"custom-loader"},Te={class:"text-link text-base font-weight-medium d-inline-block"},Ue={class:"d-flex align-center gap-x-4",style:{"min-inline-size":"240px"}},Be={class:"w-75"},Ie={class:"w-25"},Re={class:"text-center"},Le={key:0},he={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},ze={class:"text-sm text-medium-emphasis mb-0"},Me={__name:"index",async setup(Ne){let c,b;const x=l(""),K=_e("userData").value,y=l([]),k=l(8),d=l(1),B=l(0),u=l(!1),I=l(""),R=l(""),L=l(""),h=l(),C=l(""),z=l(!1),w=l(null),W=[{title:"Numéro de carte",key:"card_number_fr"},{title:"Prix de vente",key:"price_fr"},{title:"Reference de la facture",key:"invoice_reference"},{title:"Possesseur",key:"possessor.name"},{title:"Statut",key:"status_fr"},{title:"Expiration",key:"expiration_per_centage"},{title:"Actions",key:"actions",sortable:!1}],{data:D,execute:M}=([c,b]=q(()=>G(H("/credit-card",{query:{search:x,page:d,possessor_id:w,with_possessor:"true",status:"owned",order_by_desc:"updated_at-id"}}))),c=await c,b(),c),X=r=>{y.value[r]=!0,setTimeout(()=>{y.value[r]=!1},1e3)},Y=r=>{d.value=r.page},Z=async r=>{const e=await ve(`credit-card/${r}`,{method:"DELETE"});await M(),C.value="",S.value="",S.value=e.messages.creditCard,$.value=!0},{data:ee,execute:te}=([c,b]=q(()=>G(H("/user",{query:{paginate:"false",multi_profile:{marketing_manager:"rc-mm-ah",agency_head:"rc-ah",responsible_for_customer:"rc"}[K.role]}}))),c=await c,b(),c),ae=P(()=>ee.value.data),N=P(()=>D.value.data);console.log("mes cartes",N);const j=P(()=>D.value.total),F=P(()=>D.value.last_page),$=l(!1),S=l(""),oe=l("success");return(r,e)=>{const se=fe,re=me,E=ge("IconBtn"),le=pe,ie=ne;return m(),O("div",null,[a(J,{title:"Filtres",class:"mb-6"},{default:o(()=>[a(T,null,{default:o(()=>[a(ke,null,{default:o(()=>[a(Ce,{cols:"12",sm:"4"},{default:o(()=>[a(se,{modelValue:s(w),"onUpdate:modelValue":e[0]||(e[0]=t=>p(w)?w.value=t:null),placeholder:"Possesseur","item-title":"name","item-value":"id",items:s(ae),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})]),_:1}),a(A,{class:"my-4"})]),_:1}),n("div",Ae,[n("div",De,[a(re,{modelValue:s(x),"onUpdate:modelValue":e[1]||(e[1]=t=>p(x)?x.value=t:null),placeholder:"Rechercher une carte",density:"compact",style:{"inline-size":"300px"},class:"me-3"},null,8,["modelValue"])]),a(we),n("div",Se,[a(f,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:o(()=>e[12]||(e[12]=[i(" Export ")])),_:1}),r.$can("create","credit-card")?(m(),V(f,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"credit-card-add"}},{default:o(()=>e[13]||(e[13]=[i(" Ajouter ")])),_:1})):_("",!0),r.$can("update-price","credit-card")?(m(),V(f,{key:1,color:"primary","prepend-icon":"tabler-coin",to:{name:"credit-card-update-price"}},{default:o(()=>e[14]||(e[14]=[i(" Modifier Prix ")])),_:1})):_("",!0),a(f,{loading:s(y)[3],disabled:s(y)[3],"prepend-icon":"tabler-refresh",onClick:e[2]||(e[2]=t=>{s(M)(),s(te)(),X(3)})},{loader:o(()=>[n("span",Ee,[a(v,{icon:"tabler-refresh"})])]),default:o(()=>[e[15]||(e[15]=i(" Recharger "))]),_:1},8,["loading","disabled"])])]),a(A,{class:"mt-4"}),a(s(de),{"items-per-page":s(k),"onUpdate:itemsPerPage":e[4]||(e[4]=t=>p(k)?k.value=t:null),page:s(d),"onUpdate:page":e[5]||(e[5]=t=>p(d)?d.value=t:null),headers:W,items:s(N),"items-length":s(j),class:"text-no-wrap","onUpdate:options":Y},{"item.card_number_fr":o(({item:t})=>[a($e,{variant:"tonal",color:"error",class:"me-4",size:"40"},{default:o(()=>[a(v,{icon:"tabler-credit-card",size:"28"})]),_:1}),n("div",Te,g(t.card_number_fr),1)]),"item.status_fr":o(({item:t})=>[a(Pe,{class:"ma-2",color:{"En vente":"success","Au siège":"secondary","En agence":"primary"}[t.status_fr],label:""},{default:o(()=>[a(v,{icon:{"En vente":"tabler-shopping-bag","Au siège":"tabler-tower","En agence":"tabler-building"}[t.status_fr],start:""},null,8,["icon"]),i(" "+g(t.status_fr),1)]),_:2},1032,["color"])]),"item.expiration_per_centage":o(({item:t})=>[n("div",Ue,[n("div",Be,[a(Ve,{"model-value":t.expiration_per_centage,rounded:"",color:t.expiration_per_centage<100?"success":"error",height:8},null,8,["model-value","color"])]),n("div",Ie,g(t.expiration_date_fr),1)])]),"item.actions":o(({item:t})=>[n("div",Re,[n("div",null,[r.$can("read","credit-card")||r.$can("historical","credit-card")||r.$can("update","credit-card")?(m(),V(E,{key:0,to:{name:"credit-card-id",params:{id:t.id}}},{default:o(()=>[a(U,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:o(()=>e[16]||(e[16]=[i("Details ")])),_:1}),a(v,{icon:" tabler-eye"})]),_:2},1032,["to"])):_("",!0),r.$can("update","credit-card")?(m(),V(E,{key:1,to:{name:"credit-card-edit-id",params:{id:t.id}},disabled:t.status=="validated"},{default:o(()=>[a(U,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:o(()=>e[17]||(e[17]=[i("Modifier ")])),_:1}),a(v,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])):_("",!0)]),r.$can("delete","credit-card")?(m(),O("div",Le,[a(A),r.$can("delete","credit-card")?(m(),V(E,{key:0,disabled:t.status=="validated",onClick:je=>{B.value=t.id,I.value="Supprimer la carte",R.value="Voulez vous vraiment supprimer cette coficarte?",h.value=Z,L.value="Supprimer",z.value=!1,u.value=!0}},{default:o(()=>[a(U,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:o(()=>e[18]||(e[18]=[i("Supprimer ")])),_:1}),a(v,{icon:"tabler-trash",color:"error"})]),_:2},1032,["disabled","onClick"])):_("",!0)])):_("",!0)])]),bottom:o(()=>[a(A),n("div",he,[n("p",ze,g(s(ce)({page:s(d),itemsPerPage:s(k)},s(j))),1),a(ue,{modelValue:s(d),"onUpdate:modelValue":e[3]||(e[3]=t=>p(d)?d.value=t:null),length:s(F),"total-visible":r.$vuetify.display.xs?1:Math.min(s(F),5)},{prev:o(t=>[a(f,Q({variant:"tonal",color:"default"},t,{icon:!1}),{default:o(()=>[a(v,{start:"",icon:"tabler-arrow-left"}),e[19]||(e[19]=i(" Précedent "))]),_:2},1040)]),next:o(t=>[a(f,Q({variant:"tonal",color:"default"},t,{icon:!1}),{default:o(()=>[e[20]||(e[20]=i(" Suivant ")),a(v,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),a(xe,{modelValue:s(u),"onUpdate:modelValue":e[10]||(e[10]=t=>p(u)?u.value=t:null),class:"v-dialog-sm"},{default:o(()=>[a(le,{onClick:e[6]||(e[6]=t=>u.value=!s(u))}),a(J,{title:s(I)},{default:o(()=>[a(T,null,{default:o(()=>[i(g(s(R))+" ",1),s(z)?(m(),V(ie,{key:0,class:"mt-3",modelValue:s(C),"onUpdate:modelValue":e[7]||(e[7]=t=>p(C)?C.value=t:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):_("",!0)]),_:1}),a(T,{class:"d-flex justify-end gap-3 flex-wrap"},{default:o(()=>[a(f,{color:"secondary",variant:"tonal",onClick:e[8]||(e[8]=t=>u.value=!1)},{default:o(()=>e[21]||(e[21]=[i(" Annuler ")])),_:1}),a(f,{onClick:e[9]||(e[9]=t=>{s(h)(s(B)),u.value=!1})},{default:o(()=>[i(g(s(L)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),a(ye,{modelValue:s($),"onUpdate:modelValue":e[11]||(e[11]=t=>p($)?$.value=t:null),transition:"scale-transition",location:"top end",color:s(oe)},{default:o(()=>[i(g(s(S)),1)]),_:1},8,["modelValue","color"])])}}},_t=be(Me,[["__scopeId","data-v-b28dae1e"]]);export{_t as default};
