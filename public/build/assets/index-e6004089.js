import{_ as pe}from"./AppTextarea-f6cbfc1f.js";import{V as fe,p as ve,a as _e,_ as Ve}from"./VPagination-35ef7a05.js";import{_ as ge}from"./AppTextField-36c47f95.js";import{_ as be}from"./AppAutocomplete-43a18695.js";import{$ as ye}from"./api-85849cc0.js";import{r as n,e as ke,f as Z,g as F,c as h,a as t,w as l,u as r,y as c,h as xe,o as p,b as u,V as f,d as o,i as g,j as v,k as _,t as M,m as ee}from"./main-c1a030b6.js";import{u as te}from"./useApi-19aec288.js";import{c as ae}from"./createUrl-158efc85.js";import{_ as $e}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Q}from"./VCard-6fdda96f.js";import{V as Ce}from"./VDialog-6f3109bb.js";import{V as we}from"./VSnackbar-c35ea671.js";import{V as k}from"./VCardText-4cf73bbc.js";import{V as le,a as re}from"./VRow-b5d7590c.js";import{V as G}from"./VDivider-b2160256.js";import{V as Te}from"./VSpacer-c7f75bb0.js";import{V as z}from"./VTooltip-55dc5a01.js";import"./VTextField-6ef51958.js";import"./VImg-96e1ccfc.js";import"./VOverlay-7afe38d6.js";import"./VSelect-05ba9522.js";import"./VList-7bc83e08.js";import"./VAvatar-a68b7878.js";import"./dialog-transition-f299d117.js";import"./VMenu-e950e983.js";import"./VChip-8fa0cf71.js";import"./index-593e39a4.js";import"./useAbility-c8c15e39.js";const Ue={class:"d-flex flex-wrap gap-4 mx-5"},je={class:"d-flex align-center"},Ae={class:"d-flex gap-4 flex-wrap align-center"},Pe={class:"custom-loader"},Re={class:"text-center"},De={key:0},Ie={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Be={class:"text-sm text-medium-emphasis mb-0"},Le=["innerHTML"],Se={__name:"index",async setup(Ne){let m,x;const $=n(""),C=n([]),w=n(8),d=n(1),T=n(0),i=n(!1),U=n(""),j=n(""),b=n(""),A=n(""),P=n(),R=n("cancel"),D=n(!1),I=ke("userData").value,B=n(null),L=n(null),ne=[{title:"Initiateur",key:"sender.name"},{title:"Receptioniste",key:"receiver.name"},{title:"Commentaire",key:"comment"},{title:"Nbre de carte",key:"nbr_carte_in_transfert"},{title:"Date de transfert",key:"created_at_fr"},{title:"Actions",key:"actions",sortable:!1}],{data:E,execute:J}=([m,x]=Z(()=>te(ae("/transfer",{query:{search:$,page:d,with_sender:"true",with_receiver:"true",sender_id:B,receiver_id:L,status:"waiting"}}))),m=await m,x(),m),{data:se,execute:oe}=([m,x]=Z(()=>te(ae("/user",{query:{paginate:"false",multi_profile:{marketing_manager:"rc-ah-mm",agency_head:"rc-mm-ah",responsible_for_customer:"ah-rc"}[I.role]}}))),m=await m,x(),m),ie=s=>{C.value[s]=!0,setTimeout(()=>{C.value[s]=!1},1e3)},ue=s=>{d.value=s.page},q=async s=>{const e=await ye(`transfer/trate/${s}`,{method:"PUT",body:{action:b.value}});if(e.status==200)V.value=!0,H.value="success",R.value="",y.value="",y.value={cancel:"Transfert annulé avec succès",reject:"Transfert rejeté avec succès",validate:"Transfert validé avec succès"}[b.value];else{H.value="error",V.value=!0,y.value="";for(const S in e.errors)e.errors[S].forEach(O=>{y.value+=""+O+"<br>"})}await J(),await oe(),V.value=!0},de=F(()=>E.value.data),K=F(()=>E.value.total),W=F(()=>E.value.last_page),V=n(!1),y=n(""),H=n("success"),X=F(()=>se.value.data);return(s,e)=>{const S=be,O=ge,N=xe("IconBtn"),ce=Ve,me=pe;return p(),h("div",null,[t(Q,{class:"mb-6"},{default:l(()=>[t(k,null,{default:l(()=>[t(le,null,{default:l(()=>[t(k,null,{default:l(()=>e[13]||(e[13]=[u("h2",null," Liste des transferts ",-1)])),_:1})]),_:1})]),_:1})]),_:1}),t(Q,{title:"Filtres",class:"mb-6"},{default:l(()=>[t(k,null,{default:l(()=>[t(le,null,{default:l(()=>[t(re,{cols:"12",sm:"4"},{default:l(()=>[t(S,{modelValue:r(B),"onUpdate:modelValue":e[0]||(e[0]=a=>c(B)?B.value=a:null),placeholder:"Initiateur","item-title":"name","item-value":"id",items:r(X),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),t(re,{cols:"12",sm:"4"},{default:l(()=>[t(S,{modelValue:r(L),"onUpdate:modelValue":e[1]||(e[1]=a=>c(L)?L.value=a:null),placeholder:"Receptionniste","item-title":"name","item-value":"id",items:r(X),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})]),_:1}),t(G,{class:"my-4"})]),_:1}),u("div",Ue,[u("div",je,[t(O,{modelValue:r($),"onUpdate:modelValue":e[2]||(e[2]=a=>c($)?$.value=a:null),placeholder:"Rechercher un transfer",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),t(Te),u("div",Ae,[t(f,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:l(()=>e[14]||(e[14]=[o(" Export ")])),_:1}),s.$can("create","transfer")?(p(),g(f,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"transfer-add"}},{default:l(()=>e[15]||(e[15]=[o(" Nouveau ")])),_:1})):v("",!0),t(f,{loading:r(C)[3],disabled:r(C)[3],"prepend-icon":"tabler-refresh",onClick:e[3]||(e[3]=a=>{r(J)(),ie(3)})},{loader:l(()=>[u("span",Pe,[t(_,{icon:"tabler-refresh"})])]),default:l(()=>[e[16]||(e[16]=o(" Recharger "))]),_:1},8,["loading","disabled"])])]),t(G,{class:"mt-4"}),t(r(fe),{"items-per-page":r(w),"onUpdate:itemsPerPage":e[5]||(e[5]=a=>c(w)?w.value=a:null),page:r(d),"onUpdate:page":e[6]||(e[6]=a=>c(d)?d.value=a:null),headers:ne,items:r(de),"items-length":r(K),class:"text-no-wrap","onUpdate:options":ue},{"item.comment":l(({item:a})=>[o(M(a.comment??"-"),1)]),"item.actions":l(({item:a})=>[u("div",Re,[u("div",null,[s.$can("read","transfer")||s.$can("historical","transfer")?(p(),g(N,{key:0,to:{name:"transfer-id",params:{id:a.id}}},{default:l(()=>[t(z,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:l(()=>e[17]||(e[17]=[o("Details ")])),_:1}),t(_,{icon:" tabler-eye"})]),_:2},1032,["to"])):v("",!0),s.$can("cancel","transfer")&&a.sender_id==r(I).id?(p(),g(N,{key:1,disabled:a.status=="validated",onClick:Y=>{T.value=a.id,U.value="Annuler le transfert",j.value="Voulez vous vraiment annuler ce transfert?",P.value=q,A.value="Annuler",D.value=!1,i.value=!0,b.value="cancel"}},{default:l(()=>[t(z,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:l(()=>e[18]||(e[18]=[o("Annuler ")])),_:1}),t(_,{icon:"tabler-file-shredder",color:"error"})]),_:2},1032,["disabled","onClick"])):v("",!0),s.$can("reject","transfer")&&a.receiver_id==r(I).id?(p(),g(N,{key:2,disabled:a.status=="validated",onClick:Y=>{T.value=a.id,U.value="Rejeter le transfert",j.value="Voulez vous vraiment rejeter ce transfert?",P.value=q,A.value="Rejeter",D.value=!1,i.value=!0,b.value="reject"}},{default:l(()=>[t(z,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:l(()=>e[19]||(e[19]=[o("Rejeter ")])),_:1}),t(_,{icon:"tabler-credit-card-refund",color:"error"})]),_:2},1032,["disabled","onClick"])):v("",!0),s.$can("validate","transfer")&&a.receiver_id==r(I).id?(p(),g(N,{key:3,disabled:a.status=="validated",onClick:Y=>{T.value=a.id,U.value="Valider le transfert",j.value="Voulez vous vraiment valider ce transfert?",P.value=q,A.value="Valider",D.value=!1,i.value=!0,b.value="validate"}},{default:l(()=>[t(z,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:l(()=>e[20]||(e[20]=[o("Valider ")])),_:1}),t(_,{icon:"tabler-check",color:"success"})]),_:2},1032,["disabled","onClick"])):v("",!0)]),s.$can("cancel","transfer")||s.$can("reject","transfer")||s.$can("validate","transfer")?(p(),h("div",De)):v("",!0)])]),bottom:l(()=>[t(G),u("div",Ie,[u("p",Be,M(r(ve)({page:r(d),itemsPerPage:r(w)},r(K))),1),t(_e,{modelValue:r(d),"onUpdate:modelValue":e[4]||(e[4]=a=>c(d)?d.value=a:null),length:r(W),"total-visible":s.$vuetify.display.xs?1:Math.min(r(W),5)},{prev:l(a=>[t(f,ee({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>[t(_,{start:"",icon:"tabler-arrow-left"}),e[21]||(e[21]=o(" Précedent "))]),_:2},1040)]),next:l(a=>[t(f,ee({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>[e[22]||(e[22]=o(" Suivant ")),t(_,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),t(Ce,{modelValue:r(i),"onUpdate:modelValue":e[11]||(e[11]=a=>c(i)?i.value=a:null),class:"v-dialog-sm"},{default:l(()=>[t(ce,{onClick:e[7]||(e[7]=a=>i.value=!r(i))}),t(Q,{title:r(U)},{default:l(()=>[t(k,null,{default:l(()=>[o(M(r(j))+" ",1),r(D)?(p(),g(me,{key:0,class:"mt-3",modelValue:r(R),"onUpdate:modelValue":e[8]||(e[8]=a=>c(R)?R.value=a:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):v("",!0)]),_:1}),t(k,{class:"d-flex justify-end gap-3 flex-wrap"},{default:l(()=>[t(f,{color:"secondary",variant:"tonal",onClick:e[9]||(e[9]=a=>i.value=!1)},{default:l(()=>e[23]||(e[23]=[o(" Retour ")])),_:1}),t(f,{onClick:e[10]||(e[10]=a=>{r(P)(r(T)),i.value=!1})},{default:l(()=>[o(M(r(A)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),t(we,{modelValue:r(V),"onUpdate:modelValue":e[12]||(e[12]=a=>c(V)?V.value=a:null),transition:"scale-transition",location:"top end",color:r(H)},{default:l(()=>[u("div",{innerHTML:r(y)},null,8,Le)]),_:1},8,["modelValue","color"])])}}},mt=$e(Se,[["__scopeId","data-v-4301a5da"]]);export{mt as default};
