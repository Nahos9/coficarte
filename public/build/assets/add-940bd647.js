import{r as g}from"./validators-be8c4c00.js";import{r as d,e as I,f as C,g as q,c as L,b as u,a as r,w as t,q as $,n as N,o as M,u as m,V as j,k as S,d as y,t as O,x as P}from"./main-ab682c06.js";import{_ as z}from"./AppAutocomplete-4289cd9c.js";import{_ as G}from"./AppTextarea-f5d859b2.js";import{$ as H}from"./api-b60cb23e.js";import{u as U}from"./useApi-359dfef2.js";import{c as D}from"./createUrl-0640aad8.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";import{V as K}from"./VForm-c95c9467.js";import{V as Q}from"./VSnackbar-3d97ef73.js";import{V as E,a as c}from"./VRow-a90cbb86.js";import{V as W}from"./VCard-1d94407e.js";import{V as X}from"./VCardText-6a556de3.js";import"./VTextField-654b64b0.js";import"./VImg-d7e66a8a.js";import"./VOverlay-607de400.js";import"./VSelect-61a0cd14.js";import"./VList-d8c76082.js";import"./VAvatar-7f2408c8.js";import"./VDivider-2d66d0d2.js";import"./dialog-transition-162be527.js";import"./VMenu-7b33faa1.js";import"./VChip-e7f3e364.js";import"./index-593e39a4.js";import"./useAbility-6a37d43c.js";const Y={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},Z={class:"d-flex gap-4 align-center flex-wrap"},h={__name:"add",async setup(ee){let o,_;const T=N(),s=d({receiver_id:null,credit_card_number_list:[],comment:null}),x=()=>({receiver_id:"",credit_card_number_list:"",comment:""}),n=d(x()),v=d(),A=()=>{var l;(l=v.value)==null||l.validate().then(async({valid:e})=>{if(e){const i=await H("/transfer",{method:"POST",body:{receiver_id:s.value.receiver_id,first_credit_card_number:s.value.first_credit_card_number,last_credit_card_number:s.value.last_credit_card_number,comment:s.value.comment}});if(n.value=x(),i.status==201)p.value="Transfer initié avec succès",b.value="success",f.value=!0,T.push("/transfer");else{b.value="error",f.value=!0,p.value="";for(const a in i.errors)i.errors[a].forEach(V=>{console.log(a+": "+V),n.value[a]+=V+`
`,p.value+=a+": "+V+", "})}P(()=>{var a;(a=v.value)==null||a.resetValidation()})}})},w=I("userData").value,{data:R}=([o,_]=C(()=>U(D("/user",{query:{paginate:"false",multi_profile:{marketing_manager:"ah",agency_head:"rc-mm-c",responsible_for_customer:"ah-c"}[w.role]}}))),o=await o,_(),o),B=q(()=>R.value.data),{data:F}=([o,_]=C(()=>U(D("/credit-card",{query:{possessor_id:w.id,"relation_filter_not_in_transfer_details>transfer-status":"waiting",order_by_asc:"card_number",status:"owned",paginate:"false"}}))),o=await o,_(),o),k=q(()=>F.value.data),f=d(!1),p=d(""),b=d("success");return(l,e)=>{const i=z;return M(),L("div",null,[e[8]||(e[8]=u("div",{class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},[u("div",{class:"d-flex flex-column justify-center"},[u("h4",{class:"text-h4 font-weight-medium"}," Ajouter des cartes "),u("span",null,"Informations sur la première cartes du lot")])],-1)),r(K,{ref_key:"refForm",ref:v,onSubmit:$(A,["prevent"])},{default:t(()=>[r(E,null,{default:t(()=>[r(c,{md:"12"},{default:t(()=>[r(W,{class:"mb-6",title:"Information du transfère"},{default:t(()=>[r(X,null,{default:t(()=>[r(E,null,{default:t(()=>[r(c,{cols:"12",md:"12",lg:"12"},{default:t(()=>[r(i,{modelValue:s.value.receiver_id,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.receiver_id=a),items:m(B),"error-messages":n.value.receiver_id,label:"Receveur","item-title":"name","item-value":"id",rules:["requiredValidator"in l?l.requiredValidator:m(g)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),r(c,{cols:"12",md:"12",lg:"12"},{default:t(()=>[r(i,{modelValue:s.value.first_credit_card_number,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.first_credit_card_number=a),items:m(k),"error-messages":n.value.first_credit_card_number,label:"Début plage des cartes","item-title":"card_number_fr","item-value":"card_number",rules:["requiredValidator"in l?l.requiredValidator:m(g)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),r(c,{cols:"12",md:"12",lg:"12"},{default:t(()=>[r(i,{modelValue:s.value.last_credit_card_number,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.last_credit_card_number=a),items:m(k),"error-messages":n.value.last_credit_card_number,label:"Fin plage des cartes","item-title":"card_number_fr","item-value":"card_number",rules:["requiredValidator"in l?l.requiredValidator:m(g)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),r(c,{cols:"12",md:"12",lg:"12"},{default:t(()=>[r(G,{modelValue:s.value.comment,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.comment=a),"error-messages":n.value.comment,label:"Commentaire"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(c,{cols:"12"},{default:t(()=>[u("div",Y,[e[7]||(e[7]=u("div",{class:"d-flex flex-column justify-center"},null,-1)),u("div",Z,[r(j,{type:"reset",variant:"tonal",color:"primary"},{default:t(()=>[r(S,{start:"",icon:"tabler-circle-minus"}),e[5]||(e[5]=y(" Effacer "))]),_:1}),r(j,{type:"submit",class:"me-3"},{default:t(()=>[e[6]||(e[6]=y(" Enregistrer ")),r(S,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512),r(Q,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a),transition:"scale-transition",location:"top end",color:b.value},{default:t(()=>[y(O(p.value),1)]),_:1},8,["modelValue","color"])])}}},je=J(h,[["__scopeId","data-v-16ab17e6"]]);export{je as default};
