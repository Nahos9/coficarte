import{r as _}from"./validators-be8c4c00.js";import{E as z,G as Q,H as W,I as X,J as Y,g as $,K as Z,L as ee,a,m as B,r as v,e as ae,f as R,A as le,c as re,b as f,w as o,q as te,n as oe,s as se,o as ue,u as d,v as L,V as I,d as h,k as M,t as de,x as ie}from"./main-463077af.js";import{_ as ne}from"./AppDateTimePicker-d1a075c9.js";import{_ as me}from"./AppAutocomplete-af35b729.js";import{_ as ce}from"./AppTextField-5188a555.js";import{_ as G}from"./AppSelect-0261496b.js";import{$ as pe}from"./api-f2619c07.js";import{u as J}from"./useApi-3f1d0661.js";import{c as H}from"./createUrl-c75b8deb.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import{V as E,a as s}from"./VRow-7bef6683.js";import{V as ve}from"./VForm-a5f193dd.js";import{V as fe}from"./VSnackbar-9493ecb7.js";import{V as Ve}from"./VCard-f37805c9.js";import{V as be}from"./VCardText-f2d6cd94.js";import{m as ye,a as K}from"./VSelect-fb294b03.js";import{m as ge,u as xe,V as O}from"./VTextField-5f329365.js";import"./VOverlay-5e671133.js";import"./VImg-85115af3.js";import"./VList-36243e5d.js";import"./VAvatar-b69f6ba7.js";import"./VDivider-920c0dd6.js";import"./VMenu-3d9da805.js";import"./dialog-transition-11e18e92.js";import"./VChip-5df8d3ea.js";import"./index-593e39a4.js";import"./useAbility-c6021948.js";const ke=z({...ge(),...Q(ye(),["inline"])},"VCheckbox"),Ce=W()({name:"VCheckbox",inheritAttrs:!1,props:ke(),emits:{"update:modelValue":n=>!0,"update:focused":n=>!0},setup(n,m){let{attrs:b,slots:q}=m;const e=X(n,"modelValue"),{isFocused:V,focus:c,blur:U}=xe(n),A=Y(),u=$(()=>n.id||`checkbox-${A}`);return Z(()=>{const[x,P]=ee(b),[D,F]=O.filterProps(n),[T,N]=K.filterProps(n);return a(O,B({class:["v-checkbox",n.class]},x,D,{modelValue:e.value,"onUpdate:modelValue":k=>e.value=k,id:u.value,focused:V.value,style:n.style}),{...q,default:k=>{let{id:y,messagesId:C,isDisabled:w,isReadonly:j}=k;return a(K,B(T,{id:y.value,"aria-describedby":C.value,disabled:w.value,readonly:j.value},P,{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onFocus:c,onBlur:U}),q)}})}),{}}});const we={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},qe={class:"d-flex gap-4",style:{width:"100%"}},Ue={class:"d-flex align-center justify-center pa-2"},he={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},Ee={class:"d-flex flex-column justify-center"},Ae={class:"d-flex gap-4 align-center flex-wrap"},Pe={__name:"add",async setup(n){let m,b;const q=oe(),e=v({sale_date:null,credit_card_id:null,number_id:"8456",customer_type:null,customer_name:null,type_piece:null,number_piece:null,date_expiration:null,account_number:null,account_type_id:null,customer_phone_number:null,is_dotation:!1,code_operation:null}),V=v("");v("");const c=v(null),U=()=>({sale_date:"",credit_card_id:"",number_id:"",customer_type:"",customer_name:"",type_piece:"",number_piece:"",date_expiration:"",account_type_id:"",customer_phone_number:"",is_dotation:"",code_operation:""}),A=[{value:"cni",title:"Carte d'identité nationale"},{value:"passport",title:"Passeport"},{value:"residence_certificate",title:"Certificat de résidence"},{value:"driving_licence",title:"Permis de conduire"},{value:"carte_sej",title:"Carte de séjour"}],u=v(U()),x=v(),P=()=>{var r;(r=x.value)==null||r.validate().then(async({valid:l})=>{if(l){const i=await pe("/sale",{method:"POST",body:{sale_date:e.value.sale_date,credit_card_id:e.value.credit_card_id,number_id:e.value.number_id,customer_type:e.value.customer_type,customer_name:e.value.customer_name,type_piece:e.value.type_piece,number_piece:e.value.number_piece,date_expiration:e.value.date_expiration,account_number:e.value.account_number,account_type_id:e.value.account_type_id,customer_phone_number:e.value.customer_phone_number,is_dotation:e.value.is_dotation,code_operation:e.value.code_operation}});if(u.value=U(),i.status==201)w.value="success",y.value=!0,q.push("/sale");else{w.value="error",y.value=!0,C.value="";for(const p in i.errors)i.errors[p].forEach(g=>{console.log(p+": "+g),u.value[p]+=g+`
`,C.value+=p+": "+g+", "})}ie(()=>{var p;(p=x.value)==null||p.resetValidation()})}})},D=ae("userData").value,{data:F}=([m,b]=R(()=>J(H("/credit-card",{query:{possessor_id:D.id,status:"owned",paginate:"false"}}))),m=await m,b(),m),T=$(()=>F.value.data),{data:N}=([m,b]=R(()=>J(H("/account-type",{query:{paginate:"false"}}))),m=await m,b(),m),k=$(()=>N.value.data),y=v(!1),C=v(""),w=v("success"),j=async()=>{if(V.value){const r=await fetch(`/api/ecritures/search?search=${encodeURIComponent(V.value)}`);if(!r.ok)throw new Error("Erreur lors de la récupération des données");return await r.json()}};return le(V,async r=>{r&&(c.value=await j(),e.value.account_number=c.value.data.ecritures[0].no_compte,e.value.customer_name=c.value.data.ecritures[0].nom_replegal,e.value.customer_phone_number=c.value.data.ecritures[0].tel_replegal,e.value.customer_phone_number=c.value.data.ecritures[0].tel_replegal,e.value.date_expiration=c.value.data.ecritures[0].dval_piece,e.value.number_piece=c.value.data.ecritures[0].numero_piece_identite,e.value.code_operation=c.value.data.ecritures[0].code_oper,e.value.is_dotation=e.value.code_operation==="381")}),(r,l)=>{const i=ce,p=me,g=ne,S=se("mask");return ue(),re("div",null,[f("div",we,[f("div",qe,[l[15]||(l[15]=f("div",{class:"d-flex flex-column justify-center"},[f("h4",{class:"text-h4 font-weight-medium"},"Ajouter des cartes"),f("span",null,"Informations sur la première cartes du lot")],-1)),a(E,null,{default:o(()=>[a(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[a(i,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=t=>V.value=t),label:"Numéro de compte"},null,8,["modelValue"])]),_:1})]),_:1})])]),a(ve,{ref_key:"refForm",ref:x,onSubmit:te(P,["prevent"])},{default:o(()=>[a(E,null,{default:o(()=>[a(s,{md:"12"},{default:o(()=>[a(Ve,{class:"mb-6",title:"Information des cartes"},{default:o(()=>[a(be,null,{default:o(()=>[a(E,null,{default:o(()=>[a(s,{cols:"12",md:"12",lg:"9"},{default:o(()=>[a(E,null,{default:o(()=>[a(s,{cols:"12",md:"12",lg:"12"},{default:o(()=>[a(p,{modelValue:e.value.credit_card_id,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value.credit_card_id=t),items:d(T),"error-messages":u.value.credit_card_id,label:"Carte vendu","item-title":"card_number_fr","item-value":"id",rules:["requiredValidator"in r?r.requiredValidator:d(_)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:o(()=>[L(a(i,{modelValue:e.value.number_id,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value.number_id=t),"error-messages":u.value.number_id,label:"4 Derniers chiffres du numéro de la carte",placeholder:"Ex: 2595",rules:["requiredValidator"in r?r.requiredValidator:d(_)]},null,8,["modelValue","error-messages","rules"]),[[S,"####"]])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:o(()=>[L(a(i,{modelValue:e.value.code_operation,"onUpdate:modelValue":l[3]||(l[3]=t=>e.value.code_operation=t),"error-messages":u.value.code_operation,label:"Code opération",placeholder:"Ex: 007",rules:["requiredValidator"in r?r.requiredValidator:d(_)]},null,8,["modelValue","error-messages","rules"]),[[S,"####"]])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:o(()=>[a(G,{modelValue:e.value.customer_type,"onUpdate:modelValue":l[4]||(l[4]=t=>e.value.customer_type=t),items:[{title:"Entreprise",value:"business"},{title:"Particulier",value:"particular"}],"error-messages":u.value.customer_type,label:"Type de l'acheteur",rules:["requiredValidator"in r?r.requiredValidator:d(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:o(()=>[a(i,{modelValue:e.value.customer_name,"onUpdate:modelValue":l[5]||(l[5]=t=>e.value.customer_name=t),"error-messages":u.value.customer_name,label:"Nom du client",placeholder:"Ex: John",rules:["requiredValidator"in r?r.requiredValidator:d(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(G,{modelValue:e.value.type_piece,"onUpdate:modelValue":l[6]||(l[6]=t=>e.value.type_piece=t),items:A,"error-messages":u.value.type_piece,label:"Type de la pièce d'identité",rules:["requiredValidator"in r?r.requiredValidator:d(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(i,{modelValue:e.value.number_piece,"onUpdate:modelValue":l[7]||(l[7]=t=>e.value.number_piece=t),"error-messages":u.value.number_piece,label:"Numéro de la pièce",placeholder:"Ex: GA2456TA",rules:["requiredValidator"in r?r.requiredValidator:d(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(g,{modelValue:e.value.date_expiration,"onUpdate:modelValue":l[8]||(l[8]=t=>e.value.date_expiration=t),"error-messages":u.value.date_expiration,label:"Date de validité de la pièce d'identité",rules:["requiredValidator"in r?r.requiredValidator:d(_)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:o(()=>[a(i,{modelValue:e.value.account_number,"onUpdate:modelValue":l[9]||(l[9]=t=>e.value.account_number=t),type:"number","error-messages":u.value.account_number,label:"Numéro de compte du client",placeholder:"Ex: 371360000786"},null,8,["modelValue","error-messages"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:o(()=>[a(i,{modelValue:e.value.customer_phone_number,"onUpdate:modelValue":l[10]||(l[10]=t=>e.value.customer_phone_number=t),"error-messages":u.value.customer_phone_number,rules:["requiredValidator"in r?r.requiredValidator:d(_)],label:"Numéro de téléphone du client",placeholder:"Ex: +241 77 56 76 00"},null,8,["modelValue","error-messages","rules"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:o(()=>[a(Ce,{modelValue:e.value.is_dotation,"onUpdate:modelValue":l[11]||(l[11]=t=>e.value.is_dotation=t),"error-messages":u.value.is_dotation,label:"Dotation"},null,8,["modelValue","error-messages"])]),_:1}),a(s,{cols:"12",md:"12",lg:"12"},{default:o(()=>[a(p,{modelValue:e.value.account_type_id,"onUpdate:modelValue":l[12]||(l[12]=t=>e.value.account_type_id=t),items:d(k),"error-messages":u.value.account_type_id,label:"Type de compte","item-title":"name","item-value":"id"},null,8,["modelValue","items","error-messages"])]),_:1})]),_:1})]),_:1}),a(s,{cols:"12",md:"12",lg:"3"},{default:o(()=>[f("div",Ue,[a(g,{modelValue:e.value.sale_date,"onUpdate:modelValue":l[13]||(l[13]=t=>e.value.sale_date=t),"error-messages":u.value.sale_date,label:"Date de la vente",rules:["requiredValidator"in r?r.requiredValidator:d(_)],config:{inline:!0},class:"calendar-date-picker"},null,8,["modelValue","error-messages","rules"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(s,{cols:"12"},{default:o(()=>[f("div",he,[f("div",Ee,[a(s,{cols:"11"},{default:o(()=>[a(I,{"prepend-icon":"tabler-arrow-narrow-left",to:"/sale"},{default:o(()=>l[16]||(l[16]=[h(" ventes ")])),_:1})]),_:1})]),f("div",Ae,[a(I,{type:"reset",variant:"tonal",color:"primary"},{default:o(()=>[a(M,{start:"",icon:"tabler-circle-minus"}),l[17]||(l[17]=h(" Effacer "))]),_:1}),a(I,{type:"submit",class:"me-3"},{default:o(()=>[l[18]||(l[18]=h(" Enregistrer ")),a(M,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512),a(fe,{modelValue:y.value,"onUpdate:modelValue":l[14]||(l[14]=t=>y.value=t),transition:"scale-transition",location:"top end",color:w.value},{default:o(()=>[h(de(C.value),1)]),_:1},8,["modelValue","color"])])}}},ta=_e(Pe,[["__scopeId","data-v-ac828c21"]]);export{ta as default};
