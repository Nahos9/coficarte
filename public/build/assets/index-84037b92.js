import{_ as de}from"./AppTextarea-93d7e499.js";import{V as me,p as ce,a as pe,_ as fe}from"./VPagination-9f834bee.js";import{_ as ve}from"./AppTextField-b667de94.js";import{_ as ge}from"./AppAutocomplete-504a9932.js";import{$ as Ve}from"./api-98d9e2bb.js";import{u as K}from"./useApi-328f604d.js";import{c as W}from"./createUrl-ccc62e1a.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import{V as I}from"./VCard-7db182b5.js";import{V as ye}from"./VDialog-b462877a.js";import{V as be}from"./VSnackbar-9ceb4ab6.js";import{V as b}from"./VCardText-163c2c5d.js";import{V as X,a as F}from"./VRow-141a5c8a.js";import{V as M}from"./VDivider-5654b514.js";import{V as xe}from"./VSpacer-b2950469.js";import{r as s,f as Y,g as P,c as ke,a as t,w as l,u as o,y as d,h as we,o as g,b as i,V as p,d as r,i as x,j as k,k as f,t as S,m as Z}from"./main-f92e91a6.js";import{V as Ce}from"./VAvatar-22927773.js";import{V as N}from"./VTooltip-638ae99e.js";import"./VTextField-e2c88c63.js";import"./VImg-3802a6ff.js";import"./VOverlay-3161847d.js";import"./VSelect-ec8e1407.js";import"./VList-89b70cfa.js";import"./dialog-transition-f344a9a7.js";import"./VMenu-372648e5.js";import"./VChip-45ccf804.js";import"./index-593e39a4.js";import"./useAbility-1191e859.js";const Ae={class:"d-flex flex-wrap gap-4 mx-5"},$e={class:"d-flex align-center"},Te={class:"d-flex gap-4 flex-wrap align-center"},Ue={class:"custom-loader"},De={class:"text-link text-base font-weight-medium d-inline-block"},Pe={class:"text-center"},Se={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Le={class:"text-sm text-medium-emphasis mb-0"},Be=["innerHTML"],Ee={__name:"index",async setup(Re){let m,w;const V=s(""),C=s([]),A=s(8),u=s(1),z=s(0),c=s(!1),j=s(""),q=s(""),H=s(""),h=s(),$=s("cancel"),O=s(!1),T=s(null),U=s(null),D=s(null),ee=[{title:"Nom",key:"name"},{title:"Email",key:"email"},{title:"Profil",key:"profile_fr"},{title:"Activation",key:"activated"},{title:"Agence",key:"agency.name"},{title:"Actions",key:"actions",sortable:!1}],{data:L,execute:Q}=([m,w]=Y(()=>K(W("/user",{query:{search:V,page:u,with_agency:"true",agency_id:T,profile:U,activated:D}}))),m=await m,w(),m),{data:te,execute:ae}=([m,w]=Y(()=>K(W("/agency",{query:{search:V,page:u,with_agency:"true"}}))),m=await m,w(),m),le=n=>{C.value[n]=!0,setTimeout(()=>{C.value[n]=!1},1e3)},oe=n=>{u.value=n.page},se=async n=>{const e=await Ve(`user/${n}`,{method:"DELETE"});if(e.status==200)v.value=!0,B.value="success",$.value="",_.value="",_.value="Utilisateur Supprimé";else{B.value="error",v.value=!0,_.value="";for(const y in e.errors)e.errors[y].forEach(E=>{_.value+=""+E+"<br>"})}await Q(),await ae(),v.value=!0},G=P(()=>L.value.total),J=P(()=>L.value.last_page),v=s(!1),_=s(""),B=s("success"),ne=P(()=>L.value.data),ie=P(()=>te.value.data);return(n,e)=>{const y=ge,E=ve,R=we("IconBtn"),re=fe,ue=de;return g(),ke("div",null,[t(I,{class:"mb-6"},{default:l(()=>[t(b,null,{default:l(()=>[t(X,null,{default:l(()=>[t(b,null,{default:l(()=>e[14]||(e[14]=[i("h2",null," Liste des utilisateurs ",-1)])),_:1})]),_:1})]),_:1})]),_:1}),t(I,{title:"Filtres",class:"mb-6"},{default:l(()=>[t(b,null,{default:l(()=>[t(X,null,{default:l(()=>[t(F,{cols:"12",sm:"4"},{default:l(()=>[t(y,{modelValue:o(T),"onUpdate:modelValue":e[0]||(e[0]=a=>d(T)?T.value=a:null),placeholder:"Agence","item-title":"name","item-value":"id",items:o(ie),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),t(F,{cols:"12",sm:"4"},{default:l(()=>[t(y,{modelValue:o(U),"onUpdate:modelValue":e[1]||(e[1]=a=>d(U)?U.value=a:null),placeholder:"Profil","item-title":"name","item-value":"id",items:[{name:"Administrateur",id:"admin"},{name:"Chargé de clientèle",id:"responsible_for_customer"},{name:"Responsable marketing",id:"marketing_manager"},{name:"Chef d'agence",id:"agency_head"},{name:"Controlleur interne",id:"audit_controller"}],clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),t(F,{cols:"12",sm:"4"},{default:l(()=>[t(y,{modelValue:o(D),"onUpdate:modelValue":e[2]||(e[2]=a=>d(D)?D.value=a:null),placeholder:"Activation","item-title":"name","item-value":"id",items:[{name:"Activé",id:"true"},{name:"Désactivé",id:"false"}],clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1}),t(M,{class:"my-4"})]),_:1}),i("div",Ae,[i("div",$e,[t(E,{modelValue:o(V),"onUpdate:modelValue":e[3]||(e[3]=a=>d(V)?V.value=a:null),placeholder:"Rechercher un user",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),t(xe),i("div",Te,[t(p,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:l(()=>e[15]||(e[15]=[r(" Export ")])),_:1}),n.$can("create","user")?(g(),x(p,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"user-add"}},{default:l(()=>e[16]||(e[16]=[r(" Nouveau ")])),_:1})):k("",!0),t(p,{loading:o(C)[3],disabled:o(C)[3],"prepend-icon":"tabler-refresh",onClick:e[4]||(e[4]=a=>{o(Q)(),le(3)})},{loader:l(()=>[i("span",Ue,[t(f,{icon:"tabler-refresh"})])]),default:l(()=>[e[17]||(e[17]=r(" Recharger "))]),_:1},8,["loading","disabled"])])]),t(M,{class:"mt-4"}),t(o(me),{"items-per-page":o(A),"onUpdate:itemsPerPage":e[6]||(e[6]=a=>d(A)?A.value=a:null),page:o(u),"onUpdate:page":e[7]||(e[7]=a=>d(u)?u.value=a:null),headers:ee,items:o(ne),"items-length":o(G),class:"text-no-wrap","onUpdate:options":oe},{"item.activated":l(({item:a})=>[t(Ce,{variant:"tonal",color:{true:"success",false:"error"}[a.activated],class:"me-4",size:"40"},{default:l(()=>[t(f,{icon:{false:"tabler-lock-check",true:"tabler-lock-open"}[a.activated],size:"28"},null,8,["icon"])]),_:2},1032,["color"]),i("div",De,S({false:"Désactivé",true:"Activé"}[a.activated]),1)]),"item.actions":l(({item:a})=>[i("div",Pe,[i("div",null,[n.$can("read","user")||n.$can("historical","user")?(g(),x(R,{key:0,to:{name:"user-id",params:{id:a.id}}},{default:l(()=>[t(N,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:l(()=>e[18]||(e[18]=[r("Details ")])),_:1}),t(f,{icon:" tabler-eye"})]),_:2},1032,["to"])):k("",!0),n.$can("update","user")?(g(),x(R,{key:1,to:{name:"user-edit-id",params:{id:a.id}}},{default:l(()=>[t(N,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:l(()=>e[19]||(e[19]=[r("Modifier ")])),_:1}),t(f,{icon:" tabler-edit"})]),_:2},1032,["to"])):k("",!0),n.$can("delete","user")?(g(),x(R,{key:2,onClick:Ie=>{z.value=a.id,j.value="Supprimer le utilisateur",q.value="Voulez vous vraiment supprimer cet utilisateur?",h.value=se,H.value="Supprimer",O.value=!1,c.value=!0}},{default:l(()=>[t(N,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:l(()=>e[20]||(e[20]=[r("Supprimer ")])),_:1}),t(f,{icon:"tabler-trash",color:"error"})]),_:2},1032,["onClick"])):k("",!0)])])]),bottom:l(()=>[t(M),i("div",Se,[i("p",Le,S(o(ce)({page:o(u),itemsPerPage:o(A)},o(G))),1),t(pe,{modelValue:o(u),"onUpdate:modelValue":e[5]||(e[5]=a=>d(u)?u.value=a:null),length:o(J),"total-visible":n.$vuetify.display.xs?1:Math.min(o(J),5)},{prev:l(a=>[t(p,Z({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>[t(f,{start:"",icon:"tabler-arrow-left"}),e[21]||(e[21]=r(" Précedent "))]),_:2},1040)]),next:l(a=>[t(p,Z({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>[e[22]||(e[22]=r(" Suivant ")),t(f,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),t(ye,{modelValue:o(c),"onUpdate:modelValue":e[12]||(e[12]=a=>d(c)?c.value=a:null),class:"v-dialog-sm"},{default:l(()=>[t(re,{onClick:e[8]||(e[8]=a=>c.value=!o(c))}),t(I,{title:o(j)},{default:l(()=>[t(b,null,{default:l(()=>[r(S(o(q))+" ",1),o(O)?(g(),x(ue,{key:0,class:"mt-3",modelValue:o($),"onUpdate:modelValue":e[9]||(e[9]=a=>d($)?$.value=a:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):k("",!0)]),_:1}),t(b,{class:"d-flex justify-end gap-3 flex-wrap"},{default:l(()=>[t(p,{color:"secondary",variant:"tonal",onClick:e[10]||(e[10]=a=>c.value=!1)},{default:l(()=>e[23]||(e[23]=[r(" Retour ")])),_:1}),t(p,{onClick:e[11]||(e[11]=a=>{o(h)(o(z)),c.value=!1})},{default:l(()=>[r(S(o(H)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),t(be,{modelValue:o(v),"onUpdate:modelValue":e[13]||(e[13]=a=>d(v)?v.value=a:null),transition:"scale-transition",location:"top end",color:o(B)},{default:l(()=>[i("div",{innerHTML:o(_)},null,8,Be)]),_:1},8,["modelValue","color"])])}}},mt=_e(Ee,[["__scopeId","data-v-350ca1d5"]]);export{mt as default};
